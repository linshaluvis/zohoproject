{% extends 'base.html' %}
{% load static %}
{% block content %}




<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.4.js" integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
crossorigin="anonymous"></script>

<style>
    .modal{
      z-index: 9999;
      overflow: scroll;
    }
    /* width */
    ::-webkit-scrollbar {
        width: 10px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: #888;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    .hide {
        display: none;
    }
    .hidden {
      display: none;
  }
   
    .popup-0 {
      height: 17rem;
      width: 20rem;
      background-color: rgb(3, 3, 3);
      border-radius: 1rem;
      position: absolute;
      margin-bottom:70rem;
      left: 0%;
      transform: translate(-50%, -50%)scale(0.1);
      text-align: center;
      padding: 0 5rem 5 rem;
      color: black;
      
      visibility: hidden;
      transform: translate(-50%, -50%)scale(0.1);

    }

    .open-popup-3 {
      margin-top: -30rem;
      visibility: visible;
      transform: translate(-50%, -50%)scale(1);
      transition: transform 0.4s, top 0.4s;
      margin-left: 40rem;
    background-color: #000;
    }
</style>

<section >
    <div >
     
      <div class="col-md-12 " style="width: 100%;">
        
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

<div class="body-wrapper">
  <div class="container-fluid">
      <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="" class="text-warning-emphasis">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="" class="text-warning-emphasis">sales</a></li>
            <li class="breadcrumb-item" aria-current="page">invoice</li>
          </ol>
      </nav>

      <div class="row mt-3">
          <div class="container">
              
          </div>
      </div>
<div class="row mx-3">
    <div class="col-md-6"><a class="text-white" style="font-size: 1.5rem;"> New
            Invoice</a></div>
            <!-- <input type="hidden" name="hidden_state" id="state" value="{{company.state}}"> -->
</div>

<div>
    <form method="post" action="" enctype="multipart/form-data" class="">
        {% csrf_token %}
        <input class="hidden"  id="state1" name="hidden_state1" value="{{ details.company.state  }}">
                <input class="hidden"  id="state" name="hidden_state" value="">

                <input class="hidden" type="text" name="samp" id="samp" >
                <input class="hidden"  id="cus_place" name="hidden_cus_place"  value="">
        <div class="row mb-4 border-top pt-5">
            <div class="col-sm-2"><label for="customer_name">Customer Name*</label></div>
            <div class="col-sm-6">
                <select  class="registration-type form-control text-white" id="customer_sel" name="cx_name" >
                    <option type="hidden" value="vendor">select</option>
    
                    {% for cust in c %}
                    <option class="text-dark" value="{{cust.id}}" data-email="{{ cust.customer_email }}"  data-billingcountry="{{cust.billing_country}}"data-billingstate="{{cust.billing_state}}" data-billingcity="{{cust.billing_city}}" data-billing="{{cust.billing_address}}"  data-gsttreatment="{{ cust.GST_treatement }}" data-gstnumber="{{ cust.GST_number }}" data-placeofsupply="{{ cust.place_of_supply }}"   >{{cust.first_name}}</option>
                    {% endfor %}
                    <!-- <option value="customer">Register as a customer</option> -->
    
                </select>
            
            </div>
            <div class="col-sm-4">
              <a  href="" data-toggle="modal" data-target="#newcustomer"><i class="fa-solid  fa fa-plus p-2 rounded"
                  style="color: white; background-color: rgb(210, 132, 30);height: 37px;"></i></a>
          </div>
        </div>
     
        <div class="row mb-4">
          <div class="col-sm-2"><label for="customer_email">Customer Email</label></div>
          <div class="col-sm-6">
              <input type="text" class="form-control text-white" id="customer_email" name="customer_email" readonly>
          </div>
      </div>
      <div class="row mb-4">
        <div class="col-sm-2"><label for="customer_email">Billing address</label></div>
        <div class="col-sm-6">
          <textarea class="form-control text-white" id="combinedValuesTextarea" rows="6" cols="40"></textarea>
        </div>
    </div>
      
      <div class="row mb-4">
        <div class="col-sm-2"><label for="gst_treatment">GST Treatment</label></div>
        <div class="col-sm-6">
            <input type="text" class="form-control text-white" id="gst_treatment" name="gst_treatment" readonly>
        </div>
    </div>
    
    <div class="row mb-4" id="gst_number_container">
        <div class="col-sm-2"><label for="gst_number">GST Number</label></div>
        <div class="col-sm-6">
            <input type="text" class="form-control text-white" id="gst_number" name="gst_number" readonly>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-sm-2"><label for="place_of_supply">Place of Supply</label></div>
        <div class="col-sm-6">
            <select type="text" class="form-select rounded  text-white" id="place_of_supply" name="place_of_supply">
              <option value="" hidden></option>
              <option class="form-select rounded  text-dark" value="[AN]-Andaman And Nicobar Islands">[AN]-Andaman And Nicobar Islands</option>
               <option class="form-select rounded  text-dark" value="[AD]-Andhra Pradesh">[AD]-Andhra Pradesh</option>
              <option class="form-select rounded  text-dark" value="[AR]-Arunachal Pradesh">[AR]-Arunachal Pradesh	</option>
               <option class="form-select rounded  text-dark" value="volvo">[AS]-Assam</option>
              <option  class="form-select rounded  text-dark" value="[BR]-Bihar">[BR]-Bihar</option> 
              <option class="form-select rounded  text-dark" value="volvo">[CH]-	Chandhigarh</option>
              <option  class="form-select rounded  text-dark"value="[CG]-Chattisgarh">[CG]-Chattisgarh</option>
              <option class="form-select rounded  text-dark" value="[DD]-Daman Diu">[DD]-Daman Diu</option>
              <option class="form-select rounded  text-dark" value="volvo">[DL]-	Delhi</option>
              <option class="form-select rounded  text-dark" value="[GA]-Goa">[GA]-Goa</option> 
              <option class="form-select rounded  text-dark" value="[GJ]-Gujarat">[GJ]-Gujarat</option>
              <option class="form-select rounded  text-dark" value="[HR]-Haryana">[HR]-Haryana</option> 
              <option class="form-select rounded  text-dark" value="[HP]-Himachal Pradesh">[HP]-Himachal Pradesh</option>
              <option class="form-select rounded  text-dark" value="[JK]-Jammu And Kashmir">[JK]-Jammu And Kashmir</option>
              <option class="form-select rounded  text-dark" value="[JH]-Jharkand">[JH]-Jharkand</option>
              <option class="form-select rounded  text-dark" value="[KA]-Karnataka">[KA]-Karnataka</option>
              <option class="form-select rounded  text-dark" value="[KL]-Kerala">[KL]-Kerala</option>
              <option class="form-select rounded  text-dark" value="[LA]-Ladakh">[LA]-Ladakh</option>
              <option  class="form-select rounded  text-dark" value="[LD]-Lakshadweep">[LD]-Lakshadweep</option>
              <option class="form-select rounded  text-dark" value="[MP]-Madhyapradesh">[MP]-Madhyapradesh</option>
              <option class="form-select rounded  text-dark" value="[MH]-Maharashtra">[MH]-Maharashtra</option>
              <option class="form-select rounded  text-dark" value="[MN]-Manipur">[MN]-Manipur</option> 
               <option class="form-select rounded  text-dark" value="[ML]-Meghalaya">[ML]-Meghalaya</option>
              <option class="form-select rounded  text-dark" value="[MZ]-Mizoram">[MZ]-Mizoram</option> 
              <option class="form-select rounded  text-dark" value="[NL]-Nagaland">[NL]-Nagaland</option> 
              <option class="form-select rounded  text-dark" value="[NL]-Nagaland">[NL]-Nagaland</option>
              <option class="form-select rounded  text-dark" value="[OD]-Odisha">[OD]-Odisha</option>
              <option class="form-select rounded  text-dark" value="[PY]-Puducherry">[PY]-Puducherry</option>
              <option class="form-select rounded  text-dark" value="[PB]-Punjab">[PB]-Punjab.</option>
              <option class="form-select rounded  text-dark" value="[RL]-Rajasthan">[RL]-Rajasthan</option>
              <option class="form-select rounded  text-dark" value="[SK]-Sikkim">[SK]-Sikkim</option>
              <option class="form-select rounded  text-dark" value="[TN]-Tamilnadu">[TN]-Tamilnadu</option>
              <option class="form-select rounded  text-dark" value="[TS]-Telenghana">[TS]-Telenghana</option>
              <option class="form-select rounded  text-dark" value="[TR]-Tripura">[TR]-Tripura</option>
              <option class="form-select rounded  text-dark" value="[UP]-Uttar Pradesh">[UP]-Uttar Pradesh</option>
              <option class="form-select rounded  text-dark" value="[UK]-Utharakhand">[UK]-Utharakhand</option>
              <option  class="form-select rounded  text-dark"value="[WB]-West Bengal">[WB]-West Bengal</option>
              <option  class="form-select rounded  text-dark"value="[OT]-Other Territory">[OT]-Other Territory</option>
          </select>
        </div>
    </div>
    
    <style>
        #gst_number_container {
            
            display: none;
        }
    </style>
    
    
    <script>
        // Add an event listener to the customer selection dropdown
        document.getElementById('customer_sel').addEventListener('change', function () {
            // Get the selected option
            var selectedOption = this.options[this.selectedIndex];
            var billingCountry = selectedOption.getAttribute('data-billingcountry');
            var billingState = selectedOption.getAttribute('data-billingstate');
            var billingCity = selectedOption.getAttribute('data-billingcity');
            var billingAddress = selectedOption.getAttribute('data-billing');
            var combinedValues =  billingAddress + "\n"  + billingState + "\n" + billingCity + "\n" + billingCountry;
                            
            
            // Update the input fields with customer information
            document.getElementById('customer_email').value = selectedOption.getAttribute('data-email');
            document.getElementById('gst_treatment').value = selectedOption.getAttribute('data-gsttreatment');
            document.getElementById('place_of_supply').value = selectedOption.getAttribute('data-placeofsupply');
            document.getElementById('combinedValuesTextarea').value = combinedValues;


    
            // Check the GST treatment to determine whether to show or hide the GST number
            var gstTreatment = selectedOption.getAttribute('data-gsttreatment');
            var gstNumberField = document.getElementById('gst_number');
            var gstNumberContainer = document.getElementById('gst_number_container');
            if (gstTreatment === "Unregistered Business-not Registered under GST") {
                gstNumberField.value = ''; // Clear the value of the GST number field
                gstNumberContainer.style.display = 'none'; // Hide the GST number field container
            } else {
                gstNumberField.value = selectedOption.getAttribute('data-gstnumber');
                gstNumberContainer.style.display = 'flex'; 
            }
        });
    </script>
    

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#customer_sel').change(function () {
            var selectedOption = $(this).find(':selected');
            $('#customer_email').val(selectedOption.data('email'));
            $('#gst_treatment').val(selectedOption.data('gsttreatment'));
            $('#gst_number').val(selectedOption.data('gstnumber'));
            $('#place_of_supply').val(selectedOption.data('placeofsupply'));
        });
    });
</script>

      
      
   
</div>
        <div class="row mb-4">
            <div class="col-sm-2"><label for="estimate_number">Invoice Number</label></div>
            <div class="col-sm-6"><input type="text" class="form-control text-white" id="estimate_number" name="inv_no" value="INV-{{count}}">
               
            </div>
        </div>
        <div class="row mb-4">
            <div class="col-sm-2"><label for="reference">Order Number</label></div>
            <div class="col-sm-6"> <input type="text" class="form-control text-white" id="ord_no" name="ord_no" class="" required>
                    </div>
        </div>
    
     
      
      <div class="row mb-4 ">
          <div class="col-sm-6 col-lg-2 col-md-2">
            <label class="mr-3 " for="input-1">invoice Date</label>
          </div>
          <div class="col-sm-6 col-lg-2 col-md-2">
            <input type="date" class="form-control text-white"   name="inv_date" id="input-1" >
          </div>
          
              
          <div class="col-sm-6 col-md-2 col-lg-2">
            <label for="input-2" class="ms-5">Due Date</label>
        </div>
        <div class="col-sm-6 col-lg-2 col-md-2">
            <input type="date" class="form-control text-white" name="due_date" id="input-2" readonly>
        </div>

              
      </div>

      <script src="path/to/your/script.js"></script>
      <script>
 
       
        

      
  
</script>

            <div class="row mb-4 border-bottom pb-5">
              <div class="col-sm-2">
                <label for="input-2">Terms</label>
              
              </div>


              
              <div class="col-sm-6 ">
                <select class="my-select form-control text-white" name="term" id="inv_term">
                 
                  {% for p in payments %}
                  <option  class="dropdown-item text-dark" value="{{p.days}}">{{ p.term_name }}</option>
                  {% endfor%}
                  </select> 
                 
                </div>
                
                <div class="col-sm-4">
                    <a href="#" data-target="#newpayment" data-toggle="modal">
                        <i class="fa-solid fa fa-plus p-2 rounded" style="color: white; background-color: rgb(210, 132, 30); height: 37px;"></i>
                    </a>
                </div>
                <div class="col-sm-8">
                  <p id="alertMessage" style="color: rgb(68, 27, 182); font-style: italic;"></p> <!-- Element to display the alert -->
                </div>
                
                <script>
                  function calculateDueDate() {
                    const invoiceDate = new Date(document.getElementById('input-1').value);
                    const paymentTerm = document.getElementById('inv_term').value;
                    const dueDateField = document.getElementById('input-2');
                    const alertElement = document.getElementById('alertMessage');
                
                    if (paymentTerm === "recpt") {
                      // Due on receipt, no additional days
                      dueDateField.value = document.getElementById('input-1').value;
                      alertElement.textContent = ''; // Clear the alert message
                    } else if (paymentTerm === "Due end of the month") {
                      let dueDate;
                      const nextMonth = new Date(invoiceDate.getFullYear(), invoiceDate.getMonth() + 1, 1);
                      dueDate = new Date(nextMonth - 1);
                      const formattedDueDate = dueDate.toISOString().slice(0, 10);
                      dueDateField.value = formattedDueDate;
                      alertElement.textContent = ''; // Clear the alert message
                    } else {
                      // Get the number of days from the selected payment term
                      const days = parseInt(paymentTerm);
                      const dueDate = new Date(invoiceDate);
                      dueDate.setDate(invoiceDate.getDate() + days);
                      const formattedDueDate = dueDate.toISOString().slice(0, 10);
                      dueDateField.value = formattedDueDate;
                      alertElement.textContent = ''; // Clear the alert message
                    }
                  }
                
                  document.getElementById('input-1').addEventListener('change', function() {
                    calculateDueDate();
                  });
                
                  document.getElementById('inv_term').addEventListener('change', function() {
                    calculateDueDate(); // Update the due date
                    const alertElement = document.getElementById('alertMessage');
                    alertElement.textContent = "Please re-enter the invoice date to calculate the due date."; // Set the alert message
                  });
                
                  calculateDueDate(); // Calculate the initial due date
                </script>
                
            </div>


            
<!--payment method-->




<div class="row mb-4">
  <div class="col-sm-2">
      <label for="payment_method" >Payment Method</label>
  </div>
  <div class="col-sm-6">
      <select class="form-control text-white" name="payment_method" id="payment_method">
          <option class="form-control text-black" value="cash">Cash</option>
          <option  class="form-control text-black" value="cheque">Cheque</option>
          <option class="form-control text-black"  value="upi">UPI</option>
          {% for bank in banks %}
        <option style="color: black;" value="{{ bank.bnk_name }}">{{ bank.bnk_name }}</option>
      {% endfor %}
      </select>
  </div>
</div>
<!-- Payment Method: Cash -->
<div class="form-group row" id="cash_section" style="display: none;">
  <label for="cash" class="col-sm-2 col-form-label" style="color: black;">Cash</label>
  <div class="col-sm-6">
    <input style="color: black;" type="text" class="form-control text-dark" name="cash" id="cash">
  </div>
</div>

<!-- Payment Method: Cheque -->
<div class="form-group row" id="cheque_section" style="display: none;">
  <label for="cheque_number" class="col-sm-2 " >Cheque Number</label>
  <div class="col-sm-6">
    <input style="color: black;" type="text" class="form-control text-dark" name="cheque_number" id="cheque_number">
  </div>
</div>

<!-- Payment Method: UPI -->
<div class="form-group row" id="upi_section" style="display: none;">
  <label for="upi_id" class="col-sm-2 col-form-label" >UPI ID</label>
  <div class="col-sm-6">
    <input style="color: black;" type="text" class="form-control text-dark" name="upi_id" id="upi_id">
  </div>
</div>

<!-- Payment Method: Bank -->
<div class="form-group row" id="bank_section" style="display: none;">
  <label for="bank_name" class="col-sm-2 col-form-label">Select a Bank</label>
  <div class="col-sm-6">
    <select class="form-control text-dark" name="bank_name" id="bank_name">
     
    </select>
  </div>
</div>

<script>
  $(document).ready(function () {
      $('#payment_method').change(function () {
          var selectedMethod = $(this).val();

          if (selectedMethod === 'cheque') {
              $('#cheque_section').show();
              $('#upi_section').hide();
              $('#bank_section').hide();
          } else if (selectedMethod === 'upi') {
              $('#cheque_section').hide();
              $('#upi_section').show();
              $('#bank_section').hide();
          } else if (selectedMethod === 'bank') {
              $('#cheque_section').hide();
              $('#upi_section').hide();
              $('#bank_section').show();
          } else {
              $('#cheque_section').hide();
              $('#upi_section').hide();
              $('#bank_section').hide();
          }
      });

      // Trigger the change event on page load to initialize field visibility
      $('#payment_method').trigger('change');
  });
</script>


<div class="row  ">
  <div class="col-md-12 table-responsive-md mt-3">
      <table class="table table-bordered  mt-3" id="invoiceItemsTable">
          <thead>
              <tr>
                  <th class="text-center">#</th>
                  <th class="text-center">PRODUCT / SERVICE</th>
                  <th class="text-center">HSN</th>
                  <th class="text-center">QTY</th>
                  <th class="text-center">PRICE</th>
                  <th class="text-center">TAX (%)</th>
                  <th class="text-center">DISCOUNT</th>
                  <th class="text-center">TOTAL</th>
                  <th class="text-center">remove</th>

              </tr>
          </thead>
          <tbody id="items-table-body">
              <tr id='tab_row1'>
                  <td class="nnum" style="text-align: center;">1</td>
                  <td style="width: 20%;">
                      <div class="d-flex">
                          <div class="w-100">
                              <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                                  <input required type="text" id="item1" value="" name="item_name[]" class="dropdown-toggle form-control item-display" onkeyup="filterFunction($(this).attr('id'))"  data-toggle="dropdown" aria-expanded="false" placeholder="Items.." autocomplete="off">
                                  <ul class=" position-absolute" id="menu1"  style="overflow-y: auto; height: fit-content;max-height: 40vh;"> 
                                      {% for i in p %}
                                      <li class="dropdown-item items-options" onclick="getItemDetails($(this).parent().prev().attr('id'),`{{i.item_name}}`)">{{i.item_name}}</li>
                                      {% endfor %}
                                  </ul>
                                  
                              </div>
                          </div>
                          <a href="#">
                              <button type="button" class="btn btn-outline-secondary ml-1" data-target="#newItem" data-toggle="modal">+</button>
                          </a>
                      </div>
                  
                  </td>
                  <td>
                      <input type="hidden" name="item_id[]" id="itemId1">
                      <input type="text" name='hsn[]' id="hsn1" placeholder='HSN Code' class="form-control HSNCODE" readonly />
                  </td>
                  <td >
                      <input type="number" name='qty[]' id="qty1"  class="form-control qty mb-1" step=0 min=1  value=0 onchange="changeItemQty(this.id)" required/>
                      <input type="text" id="avl1" style="display: none;">
                      <div class="d-flex"><span>Available Qty :</span><span id="qtyspan1" class=''></span></div>
                  </td>
                  <td>
                      <input type="number" name='price[]' id="price1" class="form-control price" step="0.00" min="0" style=" display: block;" value=0 readonly />
                      <input type="number" name='priceListPrice[]' id="priceListPrice1" class="form-control priceListPrice" step="0.00" min="0" style="display: none;" value=0 readonly />
                  </td>
                  
                  <td style="width: 13%;">
                      <!-- <input type="text"  id="select_tax" placeholder="Tax Rate" class="form-control seltax d-flex"> -->
                      <select name='taxGST[]' id="taxGST1" class="form-control tax_ref tax_ref_gst" style="display: block;" onchange="taxchange(this.id)">
                          <option selected disabled hidden>Select GST</option>
                          <option value=28 >28.0% GST</option>
                          <option value=18 >18.0% GST</option>
                          <option value=12 >12.0% GST</option>
                          <option value=5 >05.0% GST</option>
                          <option value=3 >03.0% GST</option>
                          <option value=0 >0.0% GST</option>
                      </select>
                      <select name='taxIGST[]' id="taxIGST1" class="form-control tax_ref tax_ref_igst" style="display: none;" onchange="taxchange(this.id)">
                          <option selected disabled hidden >Select IGST</option>
                          <option value=28 >28.0% IGST</option>
                          <option value=18 >18.0% IGST</option>
                          <option value=12 >12.0% IGST</option>
                          <option value=5 >05.0% IGST</option>
                          <option value=3 >03.0% IGST</option>
                          <option value=0 >0.0% IGST</option>
                      </select>
                      <div class="mt-1" style=" text-align: center;color: red;" ><span id="invalidtax1" style="display: none;"> Invalid Tax %</span> </div>    
                  </td>
                  <td >
                      <input type="number" name='discount[]'  placeholder='Enter Discount' id="disc1" value=0 class="form-control disc" step=0 min=0   />
                  </td>

                  <td><input type="number" name='total[]' id="total1" class="form-control total" value=0 readonly  /></td>
                  <td style="display: none;"><input type="hidden" id="taxamount1" class="form-control itemTaxAmount" /></td>
                  <td>
                      <button type="button" id="1" class="btn font-weight-bold clone_row fa fa-clone px-2 my-1 py-1" title="Clone Row" style="background-color:rgb(88, 107, 143);"></button><br>
                      <button type="button" id="1" class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close" title="Remove Row"> </button>
                  </td>
              </tr>
          </tbody>
          <tr>
              <td style="border: none;"><a class="btn btn-outline-secondary ml-1" role="button" id="add" >+</a></td>
          </tr>
      </table>
  </div>
</div>
<div class="row clearfix" style="margin-top:20px">
  <div class="col-md-6">
      <textarea class="form-control mt-3"  id="" name="note" placeholder="Note" style="height: 190px;"></textarea>
      <input type="file" name="file"  style="margin-top: 10px; width: 70%;">
  </div>            
  <div class="col-md-1"></div>
  <div class="col-md-5 table-responsive-md mt-3 " id="invoiceItemsTableTotal" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh;">
      <div class="p-3">
          <div class="row container-fluid p-2 m-0">
              <div class="col-sm-4 mt-2"><label class="text-center">Sub Total</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" step="any" name='subtotal' value=0.00 readonly  class="form-control" id="sub_total"></div>
          </div>
          <div class="row container-fluid p-2 m-0" id="taxamountIGST" style="display: flex;">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">IGST</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" name='igst' step="any" id="igstAmount1" value=0.00 readonly  class="form-control"/></div>
          </div>
          <div class="row container-fluid p-2 m-0" style="display: none;" id="taxamountCGST">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">CGST</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" name='cgst' step="any" id="cgstAmount1" value=0.00 readonly  class="form-control"/></div>
          </div>
          <div class="row container-fluid p-2 m-0" style="display: none;" id="taxamountSGST">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">SGST</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" name='sgst' step="any" id="sgstAmount1" value=0.00 readonly class="form-control"/></div>
          </div>
          <div class="row container-fluid p-2 m-0">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">Tax Amount</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" step="any" name='taxamount' id="tax_amount" value=0.00 readonly style="background-color: #37444f;" class="form-control"/></div>
          </div>
          
          <div class="row container-fluid p-2 m-0">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">Shipping Charge</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" step="any" name='ship' id="ship" value=0.00 class="form-control"/></div>
          </div>
          <div class="row container-fluid p-2 m-0">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">Adjustment</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" step="any" name='adj' id="adj" value=0.00 class="form-control"/></div>
          </div>
          <div class="row container-fluid p-2 m-0">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">Grand Total</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" name='grandtotal' id="grandtotal" value=0.00 readonly  class="form-control"/></div>
          </div>
      </div>
  </div>
</div>
<div class="row">
  <div class="col-md-7"></div>
  <div class="col-md-5 table-responsive-md mt-3 " id="invoiceItemsTablePaid" style=" border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh;">
      <div class="p-3">
          <div class="row container-fluid p-2 m-0">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">Paid Off</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" step="any" name='advance' id="advance"  value=0.00 class="form-control"/></div>
          </div>
          <div class="row container-fluid p-2 m-0">
              <div class="col-sm-4 mt-2"><label for="a" class="text-center">Balance</label></div>
              <div class="col-sm-1 mt-2">:</div>
              <div class="col-sm-7 mt-2"><input type="number" name='balance' id="balance" value=0.00 readonly  class="form-control" readonly /></div>
          </div>
      </div>
  </div>
</div>


<div class="row">
  <div class="col-md-7 mt-3">
      <div class="form-check">
          <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required style="background-color: #edc822;">
          <label for="agreeTerms">Agree to terms and conditions</label>
          <div class="invalid-feedback">You must agree before submitting.</div>
      </div>
  </div>
  <div class="col-md-5 mt-3 d-flex">
      <input type="submit" class="btn btn-outline-secondary w-50 text-light" name="Draft" value="Draft">
      <input type="submit" class="btn btn-outline-secondary w-50 ml-1 text-light" name="Save" value="Save">
  </div>
</div>

</div>
</div>
</div>
</div>
</form>


<!-- New Payment Term Modal -->

<div class="modal fade" id="newPaymentTerm">
<div class="modal-dialog modal-lg">
<div class="modal-content" style="background-color: #213b52;">
<div class="modal-header">
  <h5 class="m-3">New Payment Term</h5>
  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="modal-body">
  <div class="card p-3">
      <form method="post" id="newTermForm">
          {% csrf_token %}
          <div class="row mt-2">
              <div class="col-6">
                  <label for="name">Term Name</label>
                  <input type="text" name="term_name" id="termName" class="form-control w-100">
              </div>
              <div class="col-6">
                  <label for="name">Days</label>
                  <input type="number" name="days" id="termDays" class="form-control w-100" min="0" step="1">
              </div>
          </div>
          <div class="row mt-4">
              <div class="col-4"></div>
              <div class="col-4 d-flex justify-content-center">
                  <button class="btn btn-outline-secondary text-grey w-75" data-dismiss="modal" type="submit" id="savePaymentTerm">Save</button>
              </div>
              <div class="col-4"></div>
          </div>
      </form>
  </div>
</div>
</div>   
</div>
</div>        

         
                  
                


      
       <!--.................. customer modal ...........................................-->


    <div class="modal fade" id="newcustomer">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(14, 18, 21);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">New Customer</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalCustomer">
        
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="">Customer Type</label><br>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <div class="radio_opt mx-5 mt-2">
                        <input type="radio" id="business" name="radioCust" value="Business" >
                        <label for="option1">Business</label>
                      </div>
                      <div class="radio_opt mx-4 mt-2">
                        <input type="radio" id="individual" name="radioCust" value="Individual" >
                        <label for="option2">Individual</label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row mt-5">
                  <div class="col-md-3">
                    <label for="ctitle">Title</label>
                  </div>
                  <div class="col-md-3">
                    <select name="ctitle" id="ctitle" class="form-control text-dark bg-light">
                      <option value="Mr." selected>Mr.</option>
                      <option value="Mrs.">Mrs.</option>
                      <option value="Ms.">Ms.</option>
                      <option value="Miss.">Miss.</option>
                      <option value="Dr.">Dr.</option>
                    </select>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cfname">First name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="cfname" name="cfirstname" required>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="clname">Last name</label>
                    <label id="cdisplayname" name = "cdisplayname" hidden></label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="clname" name="clastname">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="ccompany">Company Name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="ccompany" name="ccompany_name">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cemail">Customer Email</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="email" class="form-control text-dark bg-light" id="cemail" name="cemail" placeholder="example@gmail.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$">    
                  </div>              
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="email">Customer Phone</label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="cw_mobile" placeholder="Work Number" maxlength="10" name="cw_mobile">
                  </div>        
                  <div class="col-md-3 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="cp_mobile" placeholder="Personal Number" maxlength="10" name="cp_mobile">
                  </div>          
                </div>

           
                <hr>
                <center><h4 class="text-uppercase mb-3"><b>Other Details</b></h4></center>
                <div class="row mt-5">
                  <div class="col-md-3 mt-2">
                    <label for="facebook">Facebook</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="facebook" placeholder="www.example.com" name="facebook">
                  </div>       
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="twitter">Twitter</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="twitter" placeholder="www.example.com" name="twitter">
                  </div>       
                </div>


                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="website">Website</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="website" placeholder="www.example.com" name="website">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cskype">Skype name/Number</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="cskype" name="cskype">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_desg">Designation</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="c_desg" name="c_desg">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_dpt">Department</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="c_dpt" name="c_dpt">
                  </div>       
                </div>

                <fieldset2 class="other details" style="display: block;">
                  <div class="form-group row mt-2">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:rgb(214, 75, 75) ;"> GST Treatment*</label>
                     
                    <div class=" col-md-6 mt-2">
                        <select name="c_gsttype" id="c_gsttype" class="form-control bg-light text-dark" onclick="gstPan_function()">
                            <option value="Select a Gst Treatment" selected>Select a Gst Treatment</option>
                            <option value="Registered Business-Regular Business that is registered under GST">Registered Business-Regular Business that is registered under GST</option>
                            <option value="Registered Business-Composition Business that is registered under the Composition scheme in GST">
                                Registered Business-Composition Business that is registered under the Composition schemen in GST
                            </option>
                            <option value="Unregistered Business-not Registered under GST">Unregistered Business-not Registered under GST</option>
                            <option value="Overseas- Persons with who you do import or exports of supplies outside india">Overseas- Persons with who you do import or exports of supplies outside india</option>
                            <option value="Special Economic Zone">Special Economic Zone</option>
                        </select><br>
                    </div>
 
 
                </div>
                <fieldset3 id="gst" style="display: none;">
                    <div class="row mt-4">
                        <label class="col-sm-12 col-md-3 col-lg-3 col-form-label"  style="color:rgb(214, 75, 75) ;"> GSTIN/UIN*</label>
                         
                        <div class=" col-md-6 mt-2">
                            <input type="text" class="form-control bg-light text-dark" name="gst_num" placeholder="29APPCK7465F1Z1" id="gst_num" onmouseout="gst_check()"> 
                            <label id="gst_label"></label>     
    
                        </div></div>

                </fieldset3>

                <fieldset4 id="pan" style="display: none;">
                    <div class=" row mt-4">
                        <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" > PAN</label>
                         
                        <div class=" col-md-6 mt-2">
                            <input type="text" class="form-control bg-light text-dark" id="pan_number" placeholder="ABCDE1234F" onmouseout="pan_check()" name="pan_number">  
                            <label id="pan_label"></label>     

    
                        </div>
     
     
                    </div>

                </fieldset4>


                <script>

                  function gstPan_function(){
                    var x=document.getElementById('c_gsttype').value
                    if(x=="Unregistered Business-not Registered under GST")
                    {
                        document.getElementById("pan").style.display="block";
                        document.getElementById("gst").style.display="none";
            
                        
                    }
                    else if((x=="Registered Business-Regular Business that is registered under GST") || (x=="Registered Business-Composition Business that is registered under the Composition scheme in GST") || (x=="Overseas- Persons with who you do import or exports of supplies outside india") || (x=="Special Economic Zone"))
                    {
                        document.getElementById("gst").style.display="block";
                        document.getElementById("pan").style.display="block";
            
            
                    }
                
                }

                function gst_check(){
                  var x=document.getElementById("gst_num").value;
                  var gst_label=document.getElementById("gst_label")
                  // var expr=/^[0-9]{15}$/;
                  var expr=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
          
                  // "[0-9]{2}[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}[1-9A-Za-z]{1}[Z]{1}[0-9a-zA-Z]{1}"
                  // /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/
                  if (!expr.test(x)) {
                      gst_label.style.color="red";
                      gst_label.innerHTML = "Invalid GST Number.";
                  }
                  else{
                      gst_label.style.color="green";
          
                      gst_label.innerHTML = "valid GST Number.";
          
                  }
              }

              function pan_check(){
                var x=document.getElementById("pan_number").value;
                var gst_label=document.getElementById("pan_label")
                var expr=    /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/
                if (!expr.test(x)) {
                    pan_label.style.color="red";
                    pan_label.innerHTML = "Invalid PAN Number.";
                }
                else{
                    pan_label.style.color="green";
        
                    pan_label.innerHTML = "valid PAN Number.";
        
                }
            }
            $(document).ready(function () {
                $(".toggle1").click(function (e) {
                  e.preventDefault();
                  $("fieldset1").toggle();
                })
              })
        
        
            $(document).ready(function () {
                $(".toggle").click(function (e) {
                  e.preventDefault();
                  $("fieldset19").toggle();
                })
              })
              $(document).ready(function () {
                $(".toggle2").click(function (e) {
                  e.preventDefault();
                 
                  $("fieldset2").toggle(); 
                  $("fieldset5").hide();
                  $("fieldset6").hide();
                  $("fieldset7").hide();
        
        
              
                })
              })
        
              $(document).ready(function () {
                $(".toggle3").click(function (e) {
                  e.preventDefault();
                  $("fieldset5").toggle();
                  $("fieldset2").hide();
                  $("fieldset6").hide();
                  $("fieldset7").hide();
        
                })
              })
              $(document).ready(function () {
                $(".toggle4").click(function (e) {
                  e.preventDefault();
                  $("fieldset6").toggle();
                  $("fieldset2").hide();
                  $("fieldset5").hide();
                  $("fieldset7").hide();
                        
                })
              })
              $(document).ready(function () {
                $(".toggle7").click(function (e) {
                  e.preventDefault();
                  $("fieldset7").toggle();
                  $("fieldset2").hide();
                  $("fieldset6").hide();
                  $("fieldset5").hide();
                 
        
                 
                })
              })
                </script>
               

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="" style="color: rgb(190, 88, 88);">Place of Supply *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <select class="form-control text-dark bg-light" id="placesupply" name="placesupply">
                      <option value="[AN]-Andaman and Nicobar Islads">[AN] Andaman and Nicobar Islads</option>
                      <option value="[AD]-Andhra Predhesh">[AD] Andhra Predhesh</option>
                      <option value="[AR]-Arunachal Predesh">[AR] Arunachal Predesh</option>
                      <option value="[AS]-Assam">[AS] Assam</option>
                      <option value="[BR]-Bihar">[BR] Bihar</option>
                      <option value="[CH]-Chandigarh">[CH] Chandigarh</option>
                      <option value="[CG]-Chhattisgarh">[CG] Chhattisgarh</option>
                      <option value="[DNH]-Dadra and Nagar Haveli">[DNH] Dadra and Nagar Haveli</option>
                      <option value="[DD]-Damn anad Diu">[DD] Damn anad Diu</option>
                      <option value="[DL]-Delhi">[DL] Delhi</option>
                      <option value="[GA]-Goa">[GA] Goa</option>
                      <option value="[GJ]-Gujarat">[GJ] Gujarat</option>
                      <option value="[HR]-Haryana">[HR] Haryana</option>
                      <option value="[HP]-Himachal Predesh">[HP] Himachal Predesh</option>
                      <option value="[JK]-Jammu and Kashmir">[JK] Jammu and Kashmir</option>
                      <option value="[JH]-Jharkhand">[JH] Jharkhand</option>
                      <option value="[KA]-Karnataka">[KA] Karnataka</option>
                      <option value="[KL]-Kerala">[KL] Kerala</option>
                      <option value="[LA]-Ladakh">[LA] Ladakh</option>
                      <option value="[LD]-Lakshadweep">[LD] Lakshadweep</option>
                      <option value="[MP]-Madhya Predesh">[MP] Madhya Predesh</option>
                      <option value="[MH]-Maharashtra">[MH] Maharashtra</option>
                      <option value="[MN]-Manipur">[MN] Manipur</option>
                      <option value="[ML]-Meghalaya">[ML] Meghalaya</option>
                      <option value="[MZ]-Mizoram">[MZ] Mizoram</option>
                      <option value="[NL]-Nagaland">[NL] Nagaland</option>
                      <option value="[OD]-Odisha">[OD] Odisha</option>
                      <option value="[PY]-Puducherry">[PY] Puducherry</option>
                      <option value="[PB]-Punjab">[PB] Punjab</option>
                      <option value="[RJ]-Rajasthan">[RJ] Rajasthan</option>
                      <option value="[SK]-Sikkim">[SK] Sikkim</option>
                      <option value="[TN]-Tamil Nadu">[TN] Tamil Nadu</option>
                      <option value="[TS]-Telangana">[TS] Telangana</option>
                      <option value="[TR]-Tripura">[TR] Tripura</option>
                      <option value="[UP]-Uttar Predesh">[UP] Uttar Predesh</option>
                      <option value="[UK]-Uttarakhand">[UK] Uttarakhand</option>
                      <option value="[WB]-West Bengal">[WB] West Bengal</option>
                      <option value="[OT]-Other Territory">[OT] Other Territory</option>
                    </select>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_tax" style="color: rgb(190, 88, 88);">Tax Preference* </label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <div class="radio_opt mx-5 mt-2">
                        <input type="radio" id="custtax1" name="radioCust1" value="Taxable" >
                        <label for="option1">Taxable</label>
                      </div>
                      <div class="radio_opt mx-4 mt-2">
                        <input type="radio" id="custtax2" name="radioCust1" value="Tax-exempt" >
                        <label for="option2">Tax-exempt</label>
                      </div>
                    </div>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_curn">Currency </label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <select class="form-control text-dark bg-light" id="c_curn" name="c_curn" required>
                      <option selected disabled value="">Choose..</option>
                      <option value="INR">INR</option>
                    </select>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_open">Opening Balance</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="c_open" name="c_open">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_terms">Payment Terms</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <select class="form-control text-dark bg-light" id="c_terms" name="c_terms" required>
                        <!-- <option selected value="15">NET 15</option>
                        <option value="30">NET 30</option>
                        <option value="45">NET 45</option>
                        <option value="60">NET 60</option>
                        <option value="90">NET 90</option>
                        <option value="">Due end of the month</option>
                        <option value="recpt">Due on receipt</option> -->
                        {% for p in payments %}
                        <option value="{{p.Terms}} {{p.id}}">{{p.Terms}}</option>
                        {% endfor %}
                      </select>                
                      <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newpayment" data-toggle="modal">+</a>   
                    </div>
                  </div>       
                </div>
                

                <hr>

                <div class="row mt-2">
                  <div class="col-md-6 mt-5 text-center text-uppercase">
                    <h4 class="mb-0">Billing Address</h4>
                  </div>
                  <div class="col-md-6 mt-5">
                    <h4 class="mb-0 text-center text-uppercase">Shipping Address</h4>
                  </div>
                </div>
                <div class="row mt-2 m-0 p-0 mb-2">
                  <div class="col-md-9"> </div>
                  <div class="col-md-3 text-right  m-0 p-0">
                    <input type="checkbox" onclick="addressSame()" id="csokay" name="csokay">
                    <label for="csokay" style="color: #909091;">Same As Billing Address</label>
                  </div>
                </div>

                <div class="row mt-5">
                  <div class="col-md-1">
                    <label for="cstreet1">Address 1</label>
                  </div>
                  <div class="col-md-4">
                    <textarea class="form-control street text-dark bg-light" id="cstreet1" name="cstreet1"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csstreet1">Address 1</label>
                  </div>
                  <div class="col-md-4 ">
                    <textarea class="form-control street text-dark bg-light" id="csstreet1" name="csstreet1"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                </div>
                <div class="row mt-5">
                  <div class="col-md-1">
                    <label for="cstreet2">Address 2</label>
                  </div>
                  <div class="col-md-4">
                    <textarea class="form-control street text-dark bg-light" id="cstreet2" name="cstreet2"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csstreet2">Address 2</label>
                  </div>
                  <div class="col-md-4 ">
                    <textarea class="form-control street text-dark bg-light" id="csstreet2" name="csstreet2"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="ccity">City</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="ccity" name="ccity" placeholder="City">  
                  </div>
                  <div class="col-md-1">
                  </div>
                  <div class="col-md-1">
                    <label for="cscity">City</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cscity" name="cscity" placeholder="City">  
                  </div>
                  <div class="col-md-1">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="cstate">State</label>
                  </div>
                  <div class="col-md-4">
                    <select type="text" class="form-control text-dark bg-light" id="cstate" name="cstate">
                      <option value="" selected>Choose</option>
                      <option value="None Of This">None Of This</option>
                      <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads</option>
                      <option value="Andhra Predhesh">Andhra Predhesh</option>
                      <option value="Arunachal Predesh">Arunachal Predesh</option>
                      <option value="Assam">Assam</option>
                      <option value="Bihar">Bihar</option>
                      <option value="Chandigarh">Chandigarh</option>
                      <option value="Chhattisgarh">Chhattisgarh</option>
                      <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                      <option value="Damn anad Diu">Damn anad Diu</option>
                      <option value="Delhi">Delhi</option>
                      <option value="Goa">Goa</option>
                      <option value="Gujarat">Gujarat</option>
                      <option value="Haryana">Haryana</option>
                      <option value="Himachal Predesh">Himachal Predesh</option>
                      <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                      <option value="Jharkhand">Jharkhand</option>
                      <option value="Karnataka">Karnataka</option>
                      <option value="Kerala">Kerala</option>
                      <option value="Ladakh">Ladakh</option>
                      <option value="Lakshadweep">Lakshadweep</option>
                      <option value="Madhya Predesh">Madhya Predesh</option>
                      <option value="Maharashtra">Maharashtra</option>
                      <option value="Manipur">Manipur</option>
                      <option value="Meghalaya">Meghalaya</option>
                      <option value="Mizoram">Mizoram</option>
                      <option value="Nagaland">Nagaland</option>
                      <option value="Odisha">Odisha</option>
                      <option value="Puducherry">Puducherry</option>
                      <option value="Punjab">Punjab</option>
                      <option value="Rajasthan">Rajasthan</option>
                      <option value="Sikkim">Sikkim</option>
                      <option value="Tamil Nadu">Tamil Nadu</option>
                      <option value="Telangana">Telangana</option>
                      <option value="Tripura">Tripura</option>
                      <option value="Uttar Predesh">Uttar Predesh</option>
                      <option value="Uttarakhand">Uttarakhand</option>
                      <option value="West Bengal">West Bengal</option>
                      <option value="Other Territory">Other Territory</option>
                    </select>
                  </div>
                  <div class="col-md-1"></div>
  
                  <div class="col-md-1">
                    <label for="csstate">State</label>
                  </div>
                  <div class="col-md-4 ">
                    <select type="text" class="form-control text-dark bg-light" id="csstate" name="csstate">
                      <option value="" selected>Choose</option>
                      <option value="None Of This">None Of This</option>
                      <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads
                      </option>
                      <option value="Andhra Predhesh">Andhra Predhesh</option>
                      <option value="Arunachal Predesh">Arunachal Predesh</option>
                      <option value="Assam">Assam</option>
                      <option value="Bihar">Bihar</option>
                      <option value="Chandigarh">Chandigarh</option>
                      <option value="Chhattisgarh">Chhattisgarh</option>
                      <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                      <option value="Damn anad Diu">Damn anad Diu</option>
                      <option value="Delhi">Delhi</option>
                      <option value="Goa">Goa</option>
                      <option value="Gujarat">Gujarat</option>
                      <option value="Haryana">Haryana</option>
                      <option value="Himachal Predesh">Himachal Predesh</option>
                      <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                      <option value="Jharkhand">Jharkhand</option>
                      <option value="Karnataka">Karnataka</option>
                      <option value="Kerala">Kerala</option>
                      <option value="Ladakh">Ladakh</option>
                      <option value="Lakshadweep">Lakshadweep</option>
                      <option value="Madhya Predesh">Madhya Predesh</option>
                      <option value="Maharashtra">Maharashtra</option>
                      <option value="Manipur">Manipur</option>
                      <option value="Meghalaya">Meghalaya</option>
                      <option value="Mizoram">Mizoram</option>
                      <option value="Nagaland">Nagaland</option>
                      <option value="Odisha">Odisha</option>
                      <option value="Puducherry">Puducherry</option>
                      <option value="Punjab">Punjab</option>
                      <option value="Rajasthan">Rajasthan</option>
                      <option value="Sikkim">Sikkim</option>
                      <option value="Tamil Nadu">Tamil Nadu</option>
                      <option value="Telangana">Telangana</option>
                      <option value="Tripura">Tripura</option>
                      <option value="Uttar Predesh">Uttar Predesh</option>
                      <option value="Uttarakhand">Uttarakhand</option>
                      <option value="West Bengal">West Bengal</option>
                      <option value="Other Territory">Other Territory</option>
                    </select>
                  </div>

                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="ccountry">Country</label>
                  </div>
                  <div class="col-md-4 ">
                    <input type="text" class="form-control text-dark bg-light" id="ccountry" name="ccountry" placeholder="Country">  
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="cscountry">Country</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cscountry"  name="cscountry" placeholder="Country">
                  </div>
                  <div class="col-md-1 "></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cpincode">Pincode</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cpincode" name="cpincode" maxlength="6" placeholder="PIN Code"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="cspincode">Pincode</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cspincode" name="cspincode" maxlength="6" placeholder="PIN Code">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cphone">Phone</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cphone" name="cphone" placeholder="Phone"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csphone">Phone</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="csphone" name="csphone" placeholder="Phone">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cfax">Fax</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cfax" name="cfax" placeholder="FAX"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csfax">Fax</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="csfax" name="csfax" placeholder="FAX">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                    <div class="col-md-6">
                      <input type="checkbox" value="" id="invalidCheck" name="invalidCheck" required>
                      <label for="invalidCheck" style="color: #909091;">Agree to terms and conditions</label>
                      <div class="invalid-feedback text-warning" >You must agree before submitting.</div>
                    </div>
                </div>
                <div class="row mt-5">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="customerSave">Submit
                      </button> 

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
                  </div>
              </div>
          </div>
      </div>  
    </div>  



<!-- ############################################################################################### -->

<!--................................................... END CUSTOMER MODAL ...................................................... -->

 <!--.................................................... PAYMENT TERMS modal............................................... -->


 <div class="modal fade" id="newpayment">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header " style="background: rgb(32, 35, 37);">
            <h3 class="m-3 text-uppercase">Add Payment Term</h3>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
          <div class="card p-3 m-3">
            <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalPayment">
              <div class="row mt-2">
                <div class="col-md-2 mt-2"></div>
                <div class="col-md-4 mt-2">
                  <center><label for="termname" style="color: rgb(190, 88, 88);">Term Name *</label></center>
                </div>

                <div class="col-md-4 mt-2">
                  <center><label for="termdays" style="color: rgb(190, 88, 88);">Number of Days *</label></center>
                </div>
                <div class="col-md-2 mt-2"></div>
              </div>


              <div class="row mt-2">
                <div class="col-md-2 mt-2"></div>

                <div class="col-md-4 mt-2">
                  <input type="text" class="form-control text-dark bg-light" id="term_name" name="term_name" required>      
                </div>

                <div class="col-md-4 mt-2">
                  <input type="text" class="form-control text-dark bg-light" id="term_days" name="term_days" required>
                </div>
                <div class="col-md-2 mt-2"></div>

              </div>
              
              <div class="row mt-5">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                  <div class="d-flex">
                    <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                    type="submit" data-dismiss="modal" id="paySave">Save
                    </button> 
                    

                    <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                      data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Cancel</span>
                    </button>
                  </div>
                </div>
                <div class="col-md-4"></div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>  
  </div>  
<!-- ................................................  END PAYMENT TERMS MODAL..................................... -->



 <!-- .................................................ITEM MODAL................................................. -->


 <div class="modal fade" id="newitem">
  <div class="modal-dialog modal-xl">
    <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
      <div class="modal-header " style="background: rgb(32, 35, 37);">
        <h3 class="m-3 text-uppercase">New Item</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="background: rgb(32, 35, 37);">
        <div class="card p-3 m-3">
          <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalItem">
            <div class="row mt-2">
              <div class="col-md-4 mr-0">
                <label class="col-form-label col-sm-2 p-0">Type <i class="fa fa-question-circle"></i></label>
              </div>
              <div class="col-md-5 ml-0 d-flex">
                <div class="radio_opt mx-5 ">
                  <input type="radio" id="item_type1" name="radioOption" value="Goods" >
                  <label for="option1">Goods</label>
                </div>
                <div class="radio_opt mx-5 ">
                  <input type="radio" id="item_type2" name="radioOption" value="Services" >
                  <label for="option2">Services</label>
                </div>
              </div>
            </div>
            <div class="row mt-2">
              <div class="col-md-3">
                <label for="name" style="color: rgb(190, 88, 88);">Name *</label>
              </div>
              <div class="col-md-6">
                <input type="text" class="form-control text-dark bg-light" id="item_name" name="item_name" required>
              </div>
            </div>
            <div class="row mt-2">
              <div class="col-md-3 ">
                <label for="units">Unit</label>
              </div>
              <div class="col-md-6">
                <div class="d-flex">
                  <select class="form-control text-dark bg-light" id="item_units" name="item_units" required>
                    <option value="">Select Unit</option>
                    {% for u in units %}
                    <option value="{{u.id}}">{{u.unit_name}}</option>
                    {% endfor %}
                  </select>                
                  <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newunit" data-toggle="modal">+</a>  
                </div>
              </div>
            </div>
            <div class="row mt-2">
              <div class="col-md-3">
                <label for="name" style="color: rgb(190, 88, 88);">HSN Code</label>
              </div>
              <div class="col-md-6">
                <input type="text" class="form-control text-dark bg-light" id="myInputField" name="hsn_number" oninput="validateInput()" required>
                <div id="validationResult"></div>
              </div>
            </div>

           
            <script>
              function validateSixDigits(field) {
                // Define the regular expression pattern for exactly six digits
                var pattern = /^\d{6}$/;
              
                // Check if the field matches the pattern
                return pattern.test(field);
              }
              
              function validateInput() {
                var inputField = document.getElementById("myInputField");
                var inputValue = inputField.value;
              
                var validationResultDiv = document.getElementById("validationResult");
              
                if (validateSixDigits(inputValue)) {
                  validationResultDiv.textContent = "Valid: The field contains exactly six digits.";
                } else {
                  validationResultDiv.textContent = "Invalid: The field does not contain exactly six digits.";
                }
              }
            
            </script>

            <div class="row mt-2">
              <div class="col-md-4 ">
                <label for="c_tax" style="color: rgb(190, 88, 88);">Tax Preference * </label>
              </div>
              <div class="col-md-5">
                <div class="d-flex">
                  <div class="radio_opt mx-5 mt-2">
                    <input type="radio" id="item-tax1" name="radioOption1" value="Taxable" >
                    <label for="option1">Taxable</label>
                  </div>
                  <div class="radio_opt mx-4 mt-2">
                    <input type="radio" id="item-tax2" name="radioOption1" value="Tax-exempt" >
                    <label for="option2">Tax-exempt</label>
                  </div>
                </div>
              </div>       
            </div>

            <div class="row mt-2 mb-4 d-none inter-intra" >
              <div class="col-md-3">
                <label for="intra">Intra-State TAX</label>
              </div>
              <div class="col-md-3">
                <select name="intra" class="form-control text-dark bg-light" id="intra">
                  <option value="">Select GST</option>

                  <option value="GST0[0%]">GST0[0%]</option>
                  <option value="GST5[5%]">GST5[5%]</option>
                  <option value="GST12[12%]">GST12[12%]</option>
                  <option value="GST18[18%]">GST18[18%]</option>
                  <option value="GST28[28%]">GST28[28%]</option>
                </select>             
              </div>

              
              <div class="col-md-2">
                <label for="inter">Inter-State TAX</label>
              </div>
              <div class="col-md-3">
                <select name="inter" class="form-control text-dark bg-light" id="inter">
                  <option value="">Select IGST</option>

                  <option value="IGST0[0%]">IGST0[0%]</option>
                  <option value="IGST5[5%]">IGST5[5%]</option>
                  <option value="IGST12[12%]">IGST12[12%]</option>
                  <option value="IGST18[18%]">IGST18[18%]]</option>
                  <option value="IGST28[28%]">IGST28[28%]</option>
                </select>               
              </div>
              <div class="col-md-1"></div>

            </div>
            
            <hr>

            <div class="row mt-5 text-center">
              <div class="col-md-6 d-flex text-center">
                <input  type="checkbox" name="selling" checked class="mx-2 my-0">
                <h6 class="m-0">Selling Information</h6>
              </div>
              <div class="col-md-6 d-flex text-center">
                <input  type="checkbox" name="purchase" checked class="mx-2 my-0">
                <h6 class="m-0">Purchase Information</h6>
              </div>
            </div>
            
            <div class="row mt-4">
              <div class="col-md-2">
                <label for="sell_price">Selling Price *</label>
              </div>
              <div class="col-md-4">
                <div class="input-group mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text">INR</div>
                  </div>
                  <input required type="text" class="form-control text-dark bg-light" name="sell_price" id="sell_price">
                </div>                  
              </div>

              <div class="col-md-2">
                <label for="cost_price">Cost Price *</label>
              </div>
              <div class="col-md-4 ">
                <div class="input-group mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text">INR</div>
                  </div>
                  <input required type="text" class="form-control text-dark bg-light" name="cost_price" id="cost_price">
                </div>
              </div>
            </div>

            <div class="row mt-2">
              <div class="col-md-2">
                <label for="vcity">Account</label>
              </div>
              <div class="col-md-4">
                <select name="sell_acc" id="sell_acc" class="form-control text-dark bg-light">
                  <option value="">Select Account</option>
   
                  
                    {% for s in sales %}
                        <option value="{{s.id}}">{{ s.Account_name }}</option>
                  {% endfor %}
                </select> 
              </div>
              <div class="col-md-2">
                <label for="cost_acc">Account</label>
              </div>
              <div class="col-md-4">
                <select name="cost_acc" class="form-control text-dark bg-light" id="cost_acc">
                  <option value="">Select Account</option>


                    {% for p in purchase %}
                        <option value="{{p.id}}">{{ p.Account_name }}</option>
                  {% endfor %}

                </select> 
              </div>
            </div>

            <div class="row mt-2">
              <div class="col-md-2">
                <label for="sell_desc">Description</label>
              </div>
              <div class="col-md-4">
                <input  type="text" name="sell_desc" class="form-control text-dark bg-light"  id="sell_desc">
              </div>

              <div class="col-md-2">
                <label for="cost_desc">Description</label>
              </div>
              <div class="col-md-4 ">
                <input  type="text" name="cost_desc" class="form-control text-dark bg-light"  id="cost_desc">
              </div>

            </div>

            <div class="row" >
              <div class="col-md-10">
                {% comment %} <label><input type="checkbox" value="trackstate" name="trackstate" onclick="toggleForm()" style="display: none;">
               Track Inventory for this item</label> {% endcomment %}
                {% comment %} <input type="hidden" name="trackState" id="trackState" value="" unchecked> {% endcomment %}
                <label>
                  <input type="checkbox" name="trackstate" value="trackstate" class=" bg-dark"  onclick="toggleFormFields()">
                  Track Inventory for this item
                </label>
                <div id="formFields" style="display: none;"> 
                  <div class="form-group row" >
                    <label class="col-sm-2 col-form-label">Inventory Account *</label>
                    <div class="col-sm-10 col-md-7 col-9" style="margin-left: -1rem;">
                      <select class="form-select form-select-sm mt-3" name="invacc">
                        <option>Choose..</option>
                        <option value="inventory assets">Inventory Asset</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group row ">
                    <label class="col-sm-2 col-form-label">Opening Stock</label>
                    <div class=" col-md-5">
                      <input  type="number" class="form-control  bg-dark"  name="openstock" value="0">
                    </div>
                    <div class="col-md-5  ">
                      <div class="row align-items-center">
                        <label class="col-sm-6 col-form-label">Opening Stock Rate per Unit</label>
                        <div class="col-sm-6">
                          <input type="number" class="form-control bg-dark" name="inventoryaccntperunit"  value="0">
                        </div>

                      </div>
                    </div>
                    <fieldset class="form-group">
                      <div class="row">
                        <label class="col-form-label col-sm-2 pt-2">Activation tag<i class="fa fa-question-circle"></i></label>
                        <div class="col-sm-10 form-inline">
                          <div class="form-check ">
                            <input  class="form-check-input" type="radio" name="satus" id="gridRadios1" value="Active"  style="margin-left:5px;" >
                            <label class="form-check-label" for="gridRadios1">Activate</label>
                          </div>
                          <div class="form-check ml-5">
                            <input  class="form-check-input" type="radio" name="satus" id="gridRadios2" value="Inactive"  style="margin-left:50px;">
                            <label class="form-check-label" for="gridRadios2">Non-Activate</label>
                          </div>
                                      
                        </div>
                      </div>
                    </fieldset>

                  </div>
                </div>
              </div>
            </div>
            <script>
              function toggleFormFields() {
                var formFields = document.getElementById("formFields");
                var checkbox = document.querySelector("input[name=trackstate]");
          
                if (checkbox.checked) {
                  formFields.style.display = "block";
                } else {
                  formFields.style.display = "none";
                }
              }
            </script>
            <br><br> <br>


            <div class="row mt-3">
                <div class="col-md-6">
                  <input type="checkbox" value="" id="invalidCheck" name="invalidCheck" required>
                  <label for="invalidCheck" style="color: #909091;">Agree to terms and conditions</label>
                  <div class="invalid-feedback text-warning" >You must agree before submitting.</div>
                </div>
            </div>
            <div class="row ">
              <div class="col-md-5"></div>
              <div class="col-md-3">
                <div class="d-flex">
                  <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="itemSave">Submit
                  </button> 

                  <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                    data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">Cancel</span>
                  </button>
                </div>
              </div>
              <div class="col-md-4"></div>
            </div>
          </form>
        </div>
      </div>
      </div>
  </div>  
</div>  


          
          
          
          <!-- ....................................................  END ITEM MODAL................................. -->

<!-- ............................................unit modal............................................ -->

 <div class="modal fade" id="newunit">
  <div class="modal-dialog modal-xl">
    <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
      <div class="modal-header " style="background: rgb(32, 35, 37);">
          <h3 class="m-3 text-uppercase">Add Unit</h3>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      <div class="modal-body" style="background: rgb(32, 35, 37);">
        <div class="card p-3 m-3">
          <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalUnit">
            <div class="row mt-2">
              <div class="col-md-3 mt-2"></div>
              <div class="col-md-1 mt-2">
                <label for="unit" style="color: rgb(190, 88, 88);">Unit</label>
              </div>

              <div class="col-md-4 mt-2">
                <input type="text" class="form-control text-dark bg-light" id="unit" name="unit" required>
              </div>
              <div class="col-md-4 mt-2"></div>
            </div>
            
            <div class="row mt-5">
              <div class="col-md-4"></div>
              <div class="col-md-4">
                <div class="d-flex">
                  <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                  type="submit" data-dismiss="modal" id="unitSave">Save
                  </button> 
                  

                  <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                    data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">Cancel</span>
                  </button>
                </div>
              </div>
              <div class="col-md-4"></div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>  
</div>  


<!-- ............................................  END UNIT MODAL..................................................... -->

</div>


</div>




    
     
      








      <script>
        function generateFullName() {
          document.getElementById('txtFullName').value =
            document.getElementById('sa').value +
            document.getElementById('fName').value + ' ' +
            document.getElementById('lName').value;
  
        }
        function myFunction() {
          var x = document.getElementById("myEmail").pattern;
          document.getElementById("demo").innerHTML = x;
        }
        function myCopyAddressFunction() {
          var checkBox = document.getElementById("myCheckT");
          var textatn = document.getElementById("batn");
          var txtcry = document.getElementById("bcty");
          var txtadrs11 = document.getElementById("bads1");
          var txtadrs12 = document.getElementById("bads2");
          var txtcty = document.getElementById("bct");
          var txtstat = document.getElementById("bst");
          var txtzip = document.getElementById("bzip");
          var txtphone = document.getElementById("bpon");
          var txtfx = document.getElementById("bfx");
  
          var textatn1 = document.getElementById("satn");
          var txtcry1 = document.getElementById("scty");
          var txtadrs21 = document.getElementById("sads1");
          var txtadrs22 = document.getElementById("sads2");
          var txtcty1 = document.getElementById("sct");
          var txtstat1 = document.getElementById("sst");
          var txtzip1 = document.getElementById("szip");
          var txtphone1 = document.getElementById("spn");
          var txtfx1 = document.getElementById("sfx");
          if (checkBox.checked == true) {
            textatn1.value = textatn.value;
            txtcry1.value = txtcry.value;
            txtadrs21.value = txtadrs11.value;
            txtadrs22.value = txtadrs12.value;
            txtcty1.value = txtcty.value;
            txtstat1.value = txtstat.value;
            txtzip1.value = txtzip.value;
            txtphone1.value = txtphone.value;
            txtphone1.value = txtfx.value;
  
          } else {
            textatn1.value = "";
            txtcry1.value = "";
            txtadrs21.value = "";
            txtadrs22.value = "";
            txtcty1.value = "";
            txtstat1.value = "";
            txtzip1.value = "";
            txtphone1.value = "";
            txtphone1.value = "";
  
          }
        }
        $(document).ready(function () {
          $(".toggle").click(function (e) {
            e.preventDefault();
            $("fieldset1").toggle();
          })
        })
        $(document).ready(function () {
          $(".toggle2").click(function (e) {
            e.preventDefault();
            $("fieldset2").toggle();
          })
        })
        $(document).ready(function () {
          $(".toggle3").click(function (e) {
            e.preventDefault();
            $("fieldset3").toggle();
          })
        })
        $(document).ready(function () {
          $(".toggle4").click(function (e) {
            e.preventDefault();
            $("fieldset5").toggle();
          })
        })
        $(document).ready(function () {
          $(".toggle6").click(function (e) {
            e.preventDefault();
            $("fieldset6").toggle();
          })
        })
        $(document).ready(function () {
          $(".toggle7").click(function (e) {
            e.preventDefault();
            $("fieldset7").toggle();
          })
        })
        $(document).ready(function () {
          $(".toggle9").click(function (e) {
            e.preventDefault();
            $("fieldset9").toggle();
          })
        })
        $('document').ready(function () {
          $('.add_another').click(function () {
            $("#tbl").append('<tr><td><select name="Place" id="PLACE"><option value="value" selected>Mr.</option><option value="volvo">Mrs.</option><option value="saab">Ms.</option><option value="mercedes">Miss.</option><option value="audi">Dr.</option></select>  </td><td><input type="text" class="txtbox" value="" /></td><td><input type="text" class="txtbox" value="" /></td><td><input type="text" class="txtbox" value="" /></td><td><input type="text" class="txtbox" value="" /></td><td><input type="text" class="txtbox" value="" /></td><td><input type="text" class="txtbox" value="" /></td><td><input type="text" class="txtbox" value="" /></td><td><input type="text" class="txtbox" value="" /></td></tr>');
          });
        })
  
        let popu = document.getElementById("popup-0");
  
        function openpop() {
          popu.classList.add("open-popup-3");
        }
        function closepop() {
          popu.classList.remove("open-popup-3");
        }
      </script>
    </div>
    </div>
  </div>

  <script>
    const registrationTypeSelectEls = document.querySelectorAll('.registration-type');
    const registrationModalEls = document.querySelectorAll('.registration-modal');
    const closeBtnEls = document.querySelectorAll('.close-btn');

    for (let i = 0; i < registrationTypeSelectEls.length; i++) {
      registrationTypeSelectEls[i].addEventListener('change', () => {
        const selectedOption = registrationTypeSelectEls[i].value;
        if (selectedOption === 'customer' || selectedOption === 'vendor') {
          registrationModalEls[i].style.display = 'block';
        }
      });

      closeBtnEls[i].addEventListener('click', () => {
        registrationModalEls[i].style.display = 'none';
      });

      window.addEventListener('click', (event) => {
        if (event.target === registrationModalEls[i]) {
          registrationModalEls[i].style.display = 'none';
        }
      });
    }
  </script>


<div class="modal modal-1">
    <div class="modal-content">
      <h6>Payment Terms</h6>
      <form id="terms-form" action="" method="post">
        {% csrf_token %}
        <div id="terms-container">
          <div class="form-row">
            {% for p in pay %}
            <div class="col-6">
                <input type="text" value="{{p.Terms}}" class="form-control" placeholder="Terms">
              </div>
              <div class="col-5">
                <input type="text" value="{{p.Days}}" class="form-control" placeholder="No of Days">
              </div>
            {% endfor %}

            <div class="col-6">
              <input type="text" name="terms[]" class="form-control" placeholder="Terms">
            </div>
            <div class="col-5">
              <input type="text" name="days[]" class="form-control" placeholder="No of Days">
            </div>
            <div class="col-1">
              <button type="button" class="btn btn-success add-term-row">+</button>
            </div>
          </div>
        </div>
        <div class="form-row mt-3">
          <div class="col-12 text-right">
            <input type="submit" class="btn btn-success" value="submit">
          </div>
        </div>
      </form>
    </div>
  </div>


<script>

  // payment term modal

$(document).on("click","#paySave",function(){
  $.ajax({
    
    type : 'POST',
    url:"",

    data:{
        name : $("#term_name").val(),
        days : $("#term_days").val(),
        
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        document.getElementById("modalPayment").reset();
        reloadPayment();
      },
  });        
});

function reloadPayment() {

  $.ajax({
    url: "",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('#c_terms');
      dropdown.empty();
      // dropdown.append(`<option selected value="15">NET 15</option>
      //                     <option value="30">NET 30</option>
      //                     <option value="45">NET 45</option>
      //                     <option value="60">NET 60</option>
      //                     <option value="90">NET 90</option>
      //                     <option value="">Due end of the month</option>
      //                     <option value="recpt">Due on receipt</option>`);
      // var drpv = $('#inv_term');
      // drpv.empty();
      // drpv.append(`<option selected value="15">NET 15</option>
      //                   <option value="30">NET 30</option>
      //                   <option value="45">NET 45</option>
      //                   <option value="60">NET 60</option>
      //                   <option value="90">NET 90</option>
      //                   <option value="">Due end of the month</option>
      //                   <option value="recpt">Due on receipt</option>`);
      $.each(data, function(key, value) {
          dropdown.append($('<option></option>').attr('value', key).text(value[0]).val(value[1]));
       });
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}

  
  // item modal

  $(document).ready(function() {

$("#item-tax1").click(function() {
  $(".inter-intra").removeClass('d-none');
  $(".inter-intra").addClass('d-flex');
});

$("#item-tax2").click(function() {

  $(".inter-intra").removeClass('d-flex');
  $(".inter-intra").addClass("d-none");
});
});


$(document).on("click","#itemSave",function(){

if ($('input[name="radioOption"]:checked').val() == 'Goods'){

    itemtype = $('#item_type1').val();
  }
else{
  itemtype = $('#item_type2').val();
}

if ($('input[name="radioOption1"]:checked').val() == 'Taxable'){
    inter_st = $('#inter').val();
    intra_st = $('#intra').val();
  }
else{
  inter_st = 0;
  intra_st = 0;
}

$.ajax({
  
  type : 'POST',
  url:"",
  
  data:{
      type : itemtype,
      name : $("#item_name").val(),
      unit : $("#item_units").val(),
      hsn_number : $("#myInputField").val(),
      inter : inter_st,
      intra : intra_st,
      sell_price : $("#sell_price").val(),
      cost_price : $("#cost_price").val(),
      sell_acc : $("#sell_acc").val(),
      cost_acc : $("#cost_acc").val(),
      sell_desc : $("#sell_desc").val(),
      cost_desc : $("#cost_desc").val(),
      
      csrfmiddlewaretoken: '{{ csrf_token }}'
      
    },
  
    success: function(response) {
      // console.log(response)
      document.getElementById("modalItem").reset();
      reloadItem();
    },
});        
});


function reloadItem() {
  $.ajax({
    url: "",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('.itm');
      var dropdown1 = $('.itmm');
      dropdown.empty();
      dropdown1.empty();

      $.each(data, function(key, value) {
          dropdown.append($('<option  class="text-dark"></option>').attr('value', key).text(value).val(value));
          dropdown1.append($('<option  class="text-dark"></option>').attr('value', key).text(value).val(value));
      });
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}




// ###################################################


// unit modal


$(document).on("click","#unitSave",function(){
  $.ajax({
    type : 'POST',
    url:"",
    data:{
        unit : $("#unit").val(),                
        csrfmiddlewaretoken: '{{ csrf_token }}'        
      },    
      success: function(response) {
        document.getElementById("modalUnit").reset();
        reloadUnit();
      },
  });        
});


function reloadUnit() {

  $.ajax({
    url: "",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('#item_units');
      dropdown.empty();

      $.each(data, function(key, value) {
          dropdown.append($('<option></option>').attr('value', key).text(value[0]).val(value[1]));
      });
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}




// #################################################


  //---------modal customer-----




  $(document).ready(function() {
    $("#cfname, #clname").change(function() {
      $("#cdisplayname").text($("#ctitle").val() +" " + $("#cfname").val() + " " + $("#clname").val());
    });
  });


// ######################################################################

$(document).on("click","#customerSave",function(){

if ($('input[name="radioCust"]:checked').val() == 'Business'){

  custType = $('#business').val();
}
else{
  custType = $('#individual').val();
}
  
if ($('input[name="radioCust1"]:checked').val() == 'Taxable'){
  cust_tax = $('#custtax1').val();
}
else{
    cust_tax = $('#custtax2').val();
}
$.ajax({
  
  type : 'POST',
  url:"",

  data:{
      customer_type : custType,
      display_name : $('#cdisplayname').text(),
      company_name : $('#ccompany').val(),
      email : $("#cemail").val(),
      work_mobile :$("#cw_mobile").val(),
      pers_mobile :$("#cp_mobile").val(),
      facebook :$("#facebook").val(),
      twitter :$("#twitter").val(),
      website :$("#website").val(),
      skype :$("#cskype").val(),
      desg :$("#c_desg").val(),
      dpt :$("#c_dpt").val(),
      gsttype :$("#c_gsttype").val(),
      gst_num :$("#gst_num").val(),
      pan_number :$("#pan_number").val(),
      placeofsupply :$("#placesupply").val(),
      tax_preference :cust_tax,
      currency : $("#c_curn").val(),
      openingbalance : $("#c_open").val(),
      paymentterms : $("#c_terms").val(),
      street1 : $("#cstreet1").val(),
      street2 : $("#cstreet2").val(),
      city : $("#ccity").val(),
      state : $("#cstate").val(),
      pincode : $("#cpincode").val(),
      fax : $("#cfax").val(),
      phone : $("#cphone").val(),
      country : $("ccountry").val(),
      csrfmiddlewaretoken: '{{ csrf_token }}'
      
    },
  
    success: function(response) {
      document.getElementById("modalCustomer").reset();
      reloadCustomer();
    },
});        
});

function reloadCustomer() {

$.ajax({ 
  url: "",
  type: "GET",
  dataType: "json",
  data: $(this).serialize(),
  csrfmiddlewaretoken: '{{ csrf_token }}',

  success: function(data) {
    var dropdown = $('#customer_sel');
    dropdown.empty();
    dropdown.append($('<option></option>').attr('value', '').text('Select'));
    $.each(data, function(key, value) {
      var option = $('<option></option>').attr('value', key).text(value['customerName']).val(key);

      option.data('email', value['customerEmail']);
      option.data('gsttreatment', value['GSTTreatment']);
      option.data('gstnumber', value['GSTIN']);  
      option.data('placeofsupply', value['placeofsupply']);

      dropdown.append(option);
  });
},
error: function(xhr, status, error) {
  console.error(xhr.responseText);
}
});
}


$(document).ready(function() {
    $('#customer_sel').change(function() {

        var name = $("#customer_sel").val();
        var na = name.split(' ')[0];
        var table = document.getElementById("item_table");
        $.ajax({

            url: "", 

            data: { 
                    id : na,
                    csrfmiddlewaretoken: '{{ csrf_token }}' 
                },

            type : 'POST',

            success: function(data) {

              $("#cemail_row").removeClass('d-none');
              $("#cemail_row").addClass('d-flex');
              
              
              $('#cx_mail').val(' '+ data.customer_email);
              $('#samp').val(data.cust_place_supply);
              $('#customer_id').val(data.cust_id);
              var plc=document.getElementById("samp").value
              
              var ste=document.getElementById("state1").value
              var y=ste.toLowerCase();  
              var inputstring=plc;
              const parts = inputstring.split("-");   
              var extractedWord = parts[1];  
              var extractedWord1= extractedWord.trim();
              var x=extractedWord1.toLowerCase();  
              $('#place_of_supply').val(x);
              $('#state').val(y);
                                if ( x == y )
                                {
                                   document.getElementById("item_table").style.display="block"
                                   document.getElementById("item_tablee").style.display="none"
                                  //  document.getElementById("label_tab1").style.display="block"
                                  //  document.getElementById("label_tab2").style.display="none"
                                   document.getElementById("add-row").style.display="block"
                                   document.getElementById("add-roww").style.display="none"
                                  


                                    
                        
                                }
                                else
                                {
                                   document.getElementById("item_table").style.display="none"
                                   document.getElementById("item_tablee").style.display="block"
                                  //  document.getElementById("label_tab1").style.display="none"
                                  //  document.getElementById("label_tab2").style.display="block"
                                   document.getElementById("add-row").style.display="none"
                                   document.getElementById("add-roww").style.display="block"
                                    
                                    
                                }
                    
              
            }
           
        });
    });
});



</script>


 <script>
     
  // Select the form and the container for the terms rows
const form = document.getElementById('terms-form');
const termsContainer = document.getElementById('terms-container');

// Select the button that adds new rows
const addTermRowBtn = document.querySelector('.add-term-row');

// Add event listener to the button
addTermRowBtn.addEventListener('click', () => {
  // Create a new row div
  const newRow = document.createElement('div');
  newRow.classList.add('form-row');

  // Create the first input field for the new row
  const termsInput = document.createElement('div');
  termsInput.classList.add('col-6');
  const termsField = document.createElement('input');
  termsField.type = 'text';
  termsField.name = 'terms[]';
  termsField.placeholder = 'Terms';
  termsField.classList.add('form-control');
  termsInput.appendChild(termsField);
  newRow.appendChild(termsInput);

  // Create the second input field for the new row
  const daysInput = document.createElement('div');
  daysInput.classList.add('col-5');
  const daysField = document.createElement('input');
  daysField.type = 'text';
  daysField.name = 'days[]';
  daysField.placeholder = 'No of Days';
  daysField.classList.add('form-control');
  daysInput.appendChild(daysField);
  newRow.appendChild(daysInput);

  // Create the delete button for the new row
  const deleteBtn = document.createElement('div');
  deleteBtn.classList.add('col-1');
  const deleteBtnEl = document.createElement('button');
  deleteBtnEl.type = 'button';
  deleteBtnEl.classList.add('btn', 'btn-danger', 'delete-term-row');
  deleteBtnEl.innerText = '-';
  deleteBtn.appendChild(deleteBtnEl);
  newRow.appendChild(deleteBtn);

  // Append the new row to the container
  termsContainer.appendChild(newRow);
});

// Add event listener to the form to delete rows
form.addEventListener('click', (event) => {
  // If the target element is a delete button
  if (event.target.classList.contains('delete-term-row')) {
    // Find the row to delete
    const row = event.target.closest('.form-row');
    // Remove the row
    row.remove();
  }
});


// Event handler for clone button  .... TABLE 1
var rowCount = 1;
$('#item_table').on('click', '.clone-row', function () {
  var row = $(this).closest('tr');
  var clonedRow = row.clone(); // Clone the current row
  var newRowId = 'row' + rowCount; // Generate a new ID for the cloned row
  clonedRow.attr('id', newRowId); // Set the new ID for the cloned row

  // Clone the options for tax, account, and item
  var currentItem = row.find('.item_select').val();
  clonedRow.find('.item_select').val(currentItem);
  
  var currentTax = row.find('.tax').val();
  clonedRow.find('.tax').val(currentTax);

  rowCount++; // Increment row counter

  $('#item_table tbody').append(clonedRow);
  var row = $(this).closest('tr');
  calc();
  calc_total();
     
});


// Event handler for clone button.....TABLE 2
var rowCount = 1;
$('#item_tablee').on('click', '.clone-roww', function () {
  var row = $(this).closest('tr');
  var clonedRow = row.clone(); // Clone the current row
  var newRowId = 'row' + rowCount; // Generate a new ID for the cloned row
  clonedRow.attr('id', newRowId); // Set the new ID for the cloned row

  // Clone the options for tax, account, and item
  var currentItem = row.find('.item_selectt').val();
  clonedRow.find('.item_selectt').val(currentItem);
  
  var currentTax = row.find('.taxx').val();
  clonedRow.find('.taxx').val(currentTax);

  rowCount++; // Increment row counter

  $('#item_tablee tbody').append(clonedRow);
  var row = $(this).closest('tr');
  calc();
  calc_total();
     
});


 </script>


<script>
const selectEl = document.querySelector('.my-select');
selectEl.addEventListener('change', () => {
const selectedOption = selectEl.value;
const modalEl = document.querySelector(`.modal.${selectedOption}`);
modalEl.style.display = 'block';
});

// Close the modal when the user clicks outside of it
const modalEls = document.querySelectorAll('.modal');
modalEls.forEach((modalEl) => {
modalEl.addEventListener('click', (event) => {
  if (event.target === modalEl) {
    modalEl.style.display = 'none';
  }
});
});
</script>  

<script>
  function validateHSN(hsnInput) {
    var hsn = hsnInput.value;
    var errorSpan = hsnInput.nextElementSibling;
    var valid = true;

    if (hsn.length != 6) {
        errorSpan.innerHTML = "HSN must be 6 digits long";
        valid = false;
    } else {
        errorSpan.innerHTML = "&#x2713;"; // Check mark
    }

    return valid;
}

</script>
<style>
  .hsn-validation {
    font-size: 1.2em;
    color: red;
}

.hsn-validation::before {
    display: inline-block;
    content: attr(data-content);
    width: 1em;
    height: 1em;
    margin-right: 0.2em;
    text-align: center;
    vertical-align: middle;
    color: green;
}

</style>

<script>
     $(document).ready(function () {



        $('#add-row').click(function () {
            var table = document.getElementById("item_table");
            var RowCount = table.rows.length;
            console.log(RowCount);
            var newRow = $(`
            <tr id='row${RowCount}' >
                <td>
                    <div class='form-group'>
                      <div class="col-md-12 d-flex align-items-center">

                        <select
                            class='form-control    text-white border-0 item_select itm' name="item[]"
                            id='item${RowCount}'>
                            <option class="text-dark" value="">Select</option>
                            {% for i in p %}
                            <option class="text-dark" value="{{i.item_name}}">{{i.item_name}}</option>
                           
                            {% endfor %}
                        </select><a href="" data-toggle="modal" data-target="#newitem"><i class="fa-solid  fa fa-plus  rounded p-1"
                          style="color: white; background-color: rgb(210, 132, 30);height: 25px;width: 100%;"></i></a>
                        </div>
                      </div>
                </td>
                <td class='text-right'>
            <input type='text' id='hsn${RowCount}'  class='form-control bg-transparent  text-white border-0  text-right hsn' name="hsn[]" placeholder="6 Digit No" pattern="[0-9]{6}" value='' readonly required>
            <span class='hsn-validation'></span>
        </td>
                <td class='text-right'><input type='number' id='qty${RowCount}'
                        class='form-control border-0 bg-transparent  text-white text-right qty' name="quantity[]" value='0' onchange="calc()">
                        <input type="text" id="avl${RowCount}" name='avl[]' style="display: none;" value="0" >

                        <div class="d-flex"><span>Available Qty :</span><span id="qtyspan${RowCount}"  name='qtyspan[]'class='qtyspan'></span></div>
                </td>
                <td class='text-right'><input type='number' id='rate${RowCount}'
                        class='form-control border-0 bg-transparent  text-white text-right rate' name="rate[]" value='0.00'
                        ></td>
                  <td class='text-right'><input type='number' id='discount${RowCount}'
                        class='form_control bg-transparent border-0 text-light text-right discount' name="discount[]" value='0.00' style="width:85%">
                </td>
                <td class='text-right'> <select name="tax[]" id='tax${RowCount}'
                        class="form-control  bg-transparent  text-white text-right border-0 tax">
                        <option>Select Tax</option>
                    <option value="0" class="text-dark">GST 0%</option>
                    <option value="3" class="text-dark">GST 3%</option>

                      <option value="5" class="text-dark">GST 5%</option>
                      <option value="12" class="text-dark">GST 12%</option>
                      <option value="18" class="text-dark">GST 18%</option>
                      <option value="28" class="text-dark">GST 28%</option>
                    
                       
                    </select></td>
                <td style="display: none;">
                    <input type="text" name="taxamount1[]" id="taxamount${RowCount}" class="form-control taxamount" />
                            </td>
                <td class='text-right'><input type='number' id='amount${RowCount}'
                        class='form-control border-0 bg-transparent  text-white text-right amount' name="amount[]" value='0.00'></td>
                <td class='text-center'><button type='button' id='del_btn${RowCount}'
                        class='btn btn-transparent text-danger btn-sm btn-outline-danger rounded-circle delete-row'
                        style='width:30px'><i class='fa fa-times'></i></button>
                        <button type='button' class='btn btn-transparent text-primary btn-sm btn-outline-primary rounded-circle clone-row' data-row=1 style='width:30px'><i class="fa fa-clone"></i>
                            </button>
                        </td>
            </tr>`);

//             $(document).on("input", ".hsn", function() {
//     var hsn_value = $(this).val();
//     var hsn_length = hsn_value.length;
//     if (hsn_length > 6) {
//         $(this).val(hsn_value.substring(0, 6));
//         alert("HSN should not be more than 6 digits!");
//     }
// });
            $('#item_table').append(newRow);
        });

        $('#item_table').on('click', '.delete-row', function () {
            $(this).closest('tr').remove();
            calc();
        });

    });
    

</script>
  


<script>
  $(document).ready(function () {
     $('#add-roww').click(function () {
         var tablee = document.getElementById("item_tablee");
         var RowCountt = tablee.rows.length;
         console.log(RowCountt);
         var newRoww= $(`
         <tr id='row${RowCountt}' >
             <td>
                 <div class='form-group'>
                  <div class="col-md-12 d-flex align-items-center">

                     <select
                         class='form-control  bg-transparent  text-white border-0 item_selectt itmm' name='itemm[]'
                         id='itemm${RowCountt}'>
                         <option class="text-dark" value="">Select</option>
                         {% for i in p %}
                         
                         <option class="text-dark" value="{{i.item_name}}">{{i.item_name}}</option>
                         {% endfor %}
                     </select>
                     <a href="" data-toggle="modal" data-target="#newitem"><i class="fa-solid  fa fa-plus  rounded p-1"
                      style="color: white; background-color: rgb(210, 132, 30);height: 25px;width: 100%;"></i></a>
                    </div>
                  </div>
             </td>
             <td class='text-right'>
         <input type='text' id='hsnn${RowCountt}'  class='form-control bg-transparent  text-white border-0  text-right hsnn' name='hsnn[]' value='' placeholder="6 Digit No" pattern="[0-9]{6}" readonly required>
         <span class='hsn-validation'></span>
     </td>
             <td class='text-right'><input type='number' id='qtyy${RowCountt}'
                     class='form-control border-0 bg-transparent  text-white text-right qtyy' name='quantityy[]' value='0' onchange="calc()">
             </td>
             <td class='text-right'><input type='number' id='ratee${RowCountt}'
                     class='form-control border-0 bg-transparent  text-white text-right ratee' name='ratee[]' value='0.00'>
                </td>
                <td class='text-right'><input type='number' id='discountt${RowCountt}'
                        class='form_control bg-transparent border-0 text-light text-right discountt' name='discountt[]' value='0.00' style="width:85%">
                </td>
             <td class='text-right'> <select name='taxx[]' id='taxx${RowCountt}'
                     class="form-control  bg-transparent  text-white text-right border-0 taxx">
                     <option>Select Tax</option>
                 
                 <option value="0" class="text-dark">IGST 0%</option>
                 <option value="3" class="text-dark">IGST 3%</option>
                   <option value="5" class="text-dark">IGST 5%</option>
                   <option value="12" class="text-dark">IGST 12%</option>
                   <option value="18" class="text-dark">IGST 18%</option>
                   <option value="28" class="text-dark">IGST 28%</option>
                    
                 </select></td>
             <td style="display: none;">
                 <input type="text" name='taxamountt1' id="taxamountt${RowCountt}" class="form-control taxamountt" />
                         </td>
             <td class='text-right'><input type='number' id='amountt${RowCountt}'
                     class='form-control border-0 bg-transparent  text-white text-right amountt' name='amountt[]' value='0.00'></td>
             <td class='text-center'><button type='button' id='del_btn${RowCountt}'
                     class='btn btn-transparent text-danger btn-sm btn-outline-danger rounded-circle delete-roww'
                     style='width:30px'><i class='fa fa-times'></i></button>
                     <button type='button' class='btn btn-transparent text-primary btn-sm btn-outline-primary rounded-circle clone-roww' data-row=1 style='width:30px'><i class="fa fa-clone"></i>
                         </button>
                     </td>
         </tr>`);


         $('#item_tablee').append(newRoww);
     });

     $('#item_tablee').on('click','.delete-roww', function () {
         $(this).closest('tr').remove();
         calc();
     });

 });
 

</script>





<script>
 $(document).ready(function() {
    // add event listener to trigger calc() function whenever a change is made to input fields
    $('#item_table').on('input', 'input', calc);
    
});
$(document).ready(function() {
    // add event listener to trigger calc() function whenever a change is made to input fields
    $('#item_tablee').on('input', 'input', calc);
});
function calculateRemainingQuantity() {
  // Get the entered quantity from the input field
  var enteredQuantity = parseInt($('#qty1').val());

  // Get the available quantity from the hidden input field
  var availableQuantity = parseInt($('#qtyspan1').val());

  // Calculate the remaining available quantity
  var remainingQuantity = availableQuantity - enteredQuantity;

  // Return the remaining available quantity
  return remainingQuantity;
}
function updateRemainingQuantity() {
  // Calculate remaining available quantity
  var remainingQuantity = calculateRemainingQuantity();

  // Display the remaining available quantity
  $('#qtyspan1').text(remainingQuantity);

  // Optionally, you can add logic to change the styling or display a message based on the remaining quantity
  if (remainingQuantity < 0) {
      $('#qtyspan1').addClass('text-danger');
  } else {
      $('#qtyspan1').removeClass('text-danger');
  }
}

function calc1() {
    // loop through each row in the table
    var x=document.getElementById("state1").value


    var y=document.getElementById("place_of_supply").value
    


if( x == y )
{ document.getElementById("item_table").style.display="block"
document.getElementById("item_tablee").style.display="none"
//  document.getElementById("label_tab1").style.display="block"
//  document.getElementById("label_tab2").style.display="none"
document.getElementById("add-row").style.display="block"
document.getElementById("add-roww").style.display="none"
  
  $('#item_table tbody tr').each(function() {
        // get the values of the input fields for this row
        var qty = $(this).find('.qty').val();
        var rate = $(this).find('.rate').val();
        var discount = $(this).find('.discount').val();
        var tax = $(this).find('.tax').val();
        var span = $(this).find('.avl').val();
        var remainingQuantity=span-qty


        $(this).find('.qtyspan').text(span - qty);


        $(this).find('.taxamount').val((qty * rate - discount) * (tax / 100));
        var taxamount = parseFloat($(this).find('.taxamount').val());
        $(this).find('.amount').val(qty * rate - discount);
        
        // // calculate the tax amount and total amount for this row
        // var taxamount = (qty * rate) * (tax / 100);
        // var amount = qty * rate;
        
        // // update the tax amount and total amount input fields for this row
        // $(this).find('.taxamount').val(taxamount.toFixed(2));
        // $(this).find('.amount').val(amount.toFixed(2));
    });
    

    // calculate the total amount and total tax amount for all rows
    var total = 0;
    var taxamount = 0;
    $('.amount').each(function() {
        total += parseFloat($(this).val());
    });
    $('.taxamount').each(function() {
        taxamount += parseFloat($(this).val());
    });
    
    // update the subtotal and total tax amount input fields
    $('#subtotal').val(total.toFixed(2));
    $('#total_taxamount').val(taxamount.toFixed(2));

    var total_with_tax = total + taxamount;
    
    // display the total amount including tax on the page
    $('#total_with_tax').val(total_with_tax.toFixed(2));

  test(taxamount);
  calc_ship();
  updateRemainingQuantity();


}

if( x != y )
{
  document.getElementById("item_table").style.display="none"
  document.getElementById("item_tablee").style.display="block"
 //  document.getElementById("label_tab1").style.display="none"
 //  document.getElementById("label_tab2").style.display="block"
  document.getElementById("add-row").style.display="none"
  document.getElementById("add-roww").style.display="block"
  
  $('#item_tablee tbody tr').each(function() {
        // get the values of the input fields for this row
        var qtyy = $(this).find('.qtyy').val();
        var ratee = $(this).find('.ratee').val();
        var discountt = $(this).find('.discountt').val();
        var taxx = $(this).find('.taxx').val();

        $(this).find('.taxamountt').val((qtyy * ratee - discountt) * (taxx / 100));
        var taxamountt = parseFloat($(this).find('.taxamountt').val());
        $(this).find('.amountt').val(qtyy * ratee - discountt);
        
        // // calculate the tax amount and total amount for this row
        // var taxamount = (qty * rate) * (tax / 100);
        // var amount = qty * rate;
        
        // // update the tax amount and total amount input fields for this row
        // $(this).find('.taxamountt').val(taxamount.toFixed(2));
        // $(this).find('.amountt').val(amount.toFixed(2));
    });
    

    // calculate the total amount and total tax amount for all rows
    var total = 0;
    var taxamount = 0;
    $('.amountt').each(function() {
        total += parseFloat($(this).val());
    });
    $('.taxamountt').each(function() {
        taxamount += parseFloat($(this).val());
    });
    
    // update the subtotal and total tax amount input fields
    $('#subtotal').val(total.toFixed(2));
    $('#total_taxamount').val(taxamount.toFixed(2));

    var total_with_tax = total + taxamount;
    
    // display the total amount including tax on the page
    $('#total_with_tax').val(total_with_tax.toFixed(2));

  test(taxamount);
  calc_ship();
  updateRemainingQuantity();


}

}

// Update subtotal when a row is deleted
// $(document).ready(function dlt () {

// var x=document.getElementById("cus_place").value
// var y=document.getElementById("state").value

// if( x == y )
// {
// $('#item_table').on('click', '.delete-row', function () {
//       var tr = $(this).closest('tr');
//       var taxamount= parseFloat(tr.find('input[name^="taxamount"]').val());
//       var amount = parseFloat(tr.find('input[name^="amount"]').val());
//       var subtotal = parseFloat($('#subtotal').val());

//       var total_taxamount = parseFloat($('#total_taxamount').val());
//       $('#total_taxamount').val((total_taxamount-taxamount).toFixed(2));

//       $('#subtotal').val((subtotal - amount).toFixed(2));

//       var total_with_tax= parseFloat($('#total_with_tax').val());
//       $('#total_with_tax').val((total_with_tax  - amount - taxamount).toFixed(2));
      
//       var pos =document.getElementById("cus_place").value;
//       var state = document.getElementById("state").value;
//       d=0
          
//           gst = taxamount / 2;
//       console.log(gst);
//       $('#cgst').val(parseFloat(gst.toFixed(2)));
//       $('#sgst').val(parseFloat(gst.toFixed(2)));
//       $('#igst').val(parseFloat(d.toFixed(2)));

//       var cgst= parseFloat($('#cgst').val());
//       $('#cgst').val(( taxamount-cgst ).toFixed(2));
//       var sgst= parseFloat($('#sgst').val());
//       $('#sgst').val(( taxamount-sgst ).toFixed(2));
//       document.getElementById("tr_cgst").style.display = "table-row";
//       document.getElementById("tr_sgst").style.display = "table-row";
     
      

//       tr.remove();
      
      
//   });
// }
// else
// {
// $('#item_tablee').on('click', '.delete-roww', function () {
//       var tr = $(this).closest('tr');
//       var taxamount= parseFloat(tr.find('input[name^="taxamountt"]').val());
//       var amount = parseFloat(tr.find('input[name^="amountt"]').val());
//       var subtotal = parseFloat($('#subtotal').val());

//       var total_taxamount = parseFloat($('#total_taxamount').val());
//       $('#total_taxamount').val((total_taxamount-taxamount).toFixed(2));

//       $('#subtotal').val((subtotal - amount).toFixed(2));

//       var total_with_tax= parseFloat($('#total_with_tax').val());
//       $('#total_with_tax').val((total_with_tax  - amount - taxamount).toFixed(2));
      
//       var pos =document.getElementById("cus_place").value;
//       var state = document.getElementById("state").value;
//       d=0
      
         
//       console.log(gst);
//       $('#cgst').val(parseFloat(d.toFixed(2)));
//       $('#sgst').val(parseFloat(d.toFixed(2)));
//       $('#igst').val(parseFloat(taxamount.toFixed(2)));

     
//       var igst= parseFloat($('#igst').val());
//       $('#igst').val(( total_taxamount-igst ).toFixed(2));
//       document.getElementById('tr_igst').style.display = "table-row";

     
     
     

//       tr.remove();
      
      
//   });
// }

// });

// ...................................................................

function calculateRemainingQuantity() {
  // Get the entered quantity from the input field
  var enteredQuantity = parseInt($('#qty1').val());

  // Get the available quantity from the hidden input field
  var availableQuantity = parseInt($('#avl1').val());


  // Calculate the remaining available quantity
  var remainingQuantity = availableQuantity - enteredQuantity;

  // Return the remaining available quantity
  return remainingQuantity;
}
function updateRemainingQuantity() {
  // Calculate remaining available quantity
  var remainingQuantity = calculateRemainingQuantity();

  // Display the remaining available quantity
  $('#qtyspan1').text(remainingQuantity);

  // Optionally, you can add logic to change the styling or display a message based on the remaining quantity
  if (remainingQuantity < 0) {
      $('#qtyspan1').addClass('text-danger');
  } else {
      $('#qtyspan1').removeClass('text-danger');
  }
}
function test(taxamount) {
        console.log('test333');
        console.log(taxamount)
        d = 0;
        var pos = document.getElementById("state1").value;
        var state = document.getElementById("place_of_supply").value;
        console.log(pos)
        console.log('state')
        console.log(state)
        console.log('state')
        console.log('----------')
        if (pos == state) {
            console.log(pos);
            console.log(state);
            console.log(taxamount);
            gst = taxamount / 2;
            console.log(gst);
            $('#cgst').val(parseFloat(gst.toFixed(2)));
            $('#sgst').val(parseFloat(gst.toFixed(2)));
            $('#igst').val(parseFloat(d.toFixed(2)));
            document.getElementById("tr_cgst").style.display = "table-row";
            document.getElementById("tr_sgst").style.display = "table-row";
            document.getElementById("tr_igst").style.display = "none";

            

           
        }

        if (pos != state) {
            console.log(pos);
            console.log(state);
            $('#igst').val(taxamount.toFixed(2));
            $('#cgst').val(d.toFixed(2));
            $('#sgst').val(d.toFixed(2));
            document.getElementById("tr_igst").style.display = "table-row";
            document.getElementById("tr_sgst").style.display = "none";
            document.getElementById("tr_cgst").style.display = "none";


        }
    }

    // Calculate total
    // $(document).ready(function () {
    //     $('#shipping_charge, #adjustment_charge').on('keyup', function () {
    //         var shipping_charge = parseFloat($('#shipping_charge').val() || 0);
    //         var adjustment_charge = parseFloat($('#adjustment_charge').val() || 0);
    //         var subtotal = parseFloat($('#subtotal').val() || 0);
    //         var total_tax = parseFloat($('#total_taxamount').val() || 0);
    //         var total = subtotal + total_tax + shipping_charge + adjustment_charge;
    //         // total = Math.round(total);

    //         $('#shipping_charge').val(shipping_charge.toFixed(2));
    //         $('#adjustment_charge').val(adjustment_charge.toFixed(2));
    //         $('#total_with_tax').val(total.toFixed(2));
    //     });
    // });

    function calc_ship()
    {
      // $('#table_tot tr').each(function() {
        var shipping_charge=parseFloat($('#shipping_charge').val());
        var adjustment_charge=parseFloat($('#adjustment_charge').val());
        var subtotal=parseFloat($('#subtotal').val());
        var total_tax=parseFloat($('#total_taxamount').val());
        var total=subtotal + total_tax + shipping_charge + adjustment_charge;

        $('#shipping_charge').val(shipping_charge.toFixed(2));
            $('#adjustment_charge').val(adjustment_charge.toFixed(2));
            $('#total_with_tax').val(total.toFixed(2));


      // });
    }


</script>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

<script>
  $(document).on('change', '#customer_sel', function () {
    var customer = $('#customer_sel').val();
    console.log(customer);
    $.ajax({
        type: "GET",
        url: "{% url 'customerdata' %}",
        data: {
            id: customer
        },
        success: function (response) {
            console.log(response)
            data7 = response.email
            console.log(data7)
            document.getElementById('cx_mail').value = data7
        }
    });
});

</script>

<script>
    var place_of_supply='';
    $(document).ready(function () {

        
        var roinc = 0
        console.log("ajax");

        $(document).on('click','#item1', function () {
            select = $('#item1').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);

            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                  },
                success: function (response) {
                    console.log(response)

                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data5 = response.place
                    data4 = response.desc
                    data6 = response.mail
                    data7 = response.avl
                    document.getElementById('qtyspan1').innerHTML = response.avl;
                    document.getElementById('avl1').value = data7





                    var customerState = data3;
                  var companyState = data5;
              
                  $(document).ready(function() {
                      if (customerState === companyState) {
                          $('#tax2 optgroup[label="GST"]').show();
                          $('#tax2 optgroup[label="IGST"]').hide();
                      } else {
                          $('#tax2 optgroup[label="GST"]').hide();
                          $('#tax2 optgroup[label="IGST"]').show();
                      }
                  });
             
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    document.getElementById('rate1').value = dataRate;
                    document.getElementById('hsn1').value = dataHSN;
                    document.getElementById('desc1').value = data4
                    alert(response.avl)

                    // document.getElementById('state').value = data5
                    // document.getElementById('cx_mail').value = data6
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst1').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst1').value = data1
                    }
                    document.getElementById('tigst1').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst1').value = data2

                }
            });

        });


        $(document).on('click', '#item2', function () {
            select = $('#item2').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);
            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                },
                success: function (response) {
                    console.log(response)
                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data5 = response.place
                    data4 = response.desc
                    data6 = response.mail
                    data7 = response.avl
                    document.getElementById('qtyspan2').innerHTML = response.avl;
                    document.getElementById('avl2').value = data7

                    var customerState = data3;
                  var companyState = data5;
              
                  $(document).ready(function() {
                      if (customerState === companyState) {
                          $('#tax2 optgroup[label="GST"]').show();
                          $('#tax2 optgroup[label="IGST"]').hide();
                      } else {
                          $('#tax2 optgroup[label="GST"]').hide();
                          $('#tax2 optgroup[label="IGST"]').show();
                      }
                  });
             
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    document.getElementById('rate2').value = dataRate;
                    document.getElementById('hsn2').value = dataHSN;
                    document.getElementById('desc2').value = data4
                    // document.getElementById('state').value = data5
                    // document.getElementById('cx_mail').value = data6
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst2').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst2').value = data1
                    }
                    document.getElementById('tigst2').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst2').value = data2

                }
            });

        });

        $(document).on('click', '#item3', function () {
            select = $('#item3').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);
            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                },
                success: function (response) {
                    console.log(response)
                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data5 = response.place
                    data4 = response.desc
                    data6 = response.mail
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    console.log(data2,data1)
                   
                  
                   // Assuming you have the customer state and company state values in variables
                   var customerState = data3;
                   var companyState = data5;
               
                   $(document).ready(function() {
                       if (customerState === companyState) {
                           $('#tax3 optgroup[label="GST"]').show();
                           $('#tax3 optgroup[label="IGST"]').hide();
                       } else {
                           $('#tax3 optgroup[label="GST"]').hide();
                           $('#tax3 optgroup[label="IGST"]').show();
                       }
                   });
                   document.getElementById('rate3').value = dataRate;
                   document.getElementById('hsn3').value = dataHSN;
                    document.getElementById('desc3').value = data4
                    // document.getElementById('state').value = data5
                    // document.getElementById('cx_mail').value = data6
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst3').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst3').value = data1
                    }
                    document.getElementById('tigst3').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst3').value = data2

                }
            });

        });


        $(document).on('click', '#item4', function () {
            select = $('#item4').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);
            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                },
                success: function (response) {
                    console.log(response)
                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data5 = response.place
                    data4 = response.desc
                    data6 = response.mail
                    var customerState = data3;
                   var companyState = data5;
               
                   $(document).ready(function() {
                       if (customerState === companyState) {
                           $('#tax4 optgroup[label="GST"]').show();
                           $('#tax4 optgroup[label="IGST"]').hide();
                       } else {
                           $('#tax4 optgroup[label="GST"]').hide();
                           $('#tax4 optgroup[label="IGST"]').show();
                       }
                   });
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    document.getElementById('rate4').value = dataRate;
                   document.getElementById('hsn4').value = dataHSN;
                    document.getElementById('desc4').value = data4
                    // document.getElementById('state').value = data5
                    // document.getElementById('cx_mail').value = data6
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst4').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst4').value = data1
                    }
                    document.getElementById('tigst4').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst4').value = data2

                }
            });

        });


        $(document).on('click', '#item5', function () {
            select = $('#item5').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);
            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                },
                success: function (response) {
                    console.log(response)
                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data5 = response.place
                    data4 = response.desc
                    data6 = response.mail
                    var customerState = data3;
                   var companyState = data5;
               
                   $(document).ready(function() {
                       if (customerState === companyState) {
                           $('#tax5 optgroup[label="GST"]').show();
                           $('#tax5 optgroup[label="IGST"]').hide();
                       } else {
                           $('#tax5 optgroup[label="GST"]').hide();
                           $('#tax5 optgroup[label="IGST"]').show();
                       }
                   });
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    document.getElementById('rate5').value = dataRate;
                   document.getElementById('hsn5').value = dataHSN;
                    document.getElementById('desc5').value = data4
                    // document.getElementById('state').value = data5
                    // document.getElementById('cx_mail').value = data6
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst5').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst5').value = data1
                    }
                    document.getElementById('tigst5').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst5').value = data2

                }
            });

        });


        $(document).on('click', '#item6', function () {
            select = $('#item6').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);
            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                },
                success: function (response) {
                    console.log(response)
                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data5 = response.place
                    data4 = response.desc
                    data6 = response.mail
                    var customerState = data3;
                   var companyState = data5;
               
                   $(document).ready(function() {
                       if (customerState === companyState) {
                           $('#tax6 optgroup[label="GST"]').show();
                           $('#tax6 optgroup[label="IGST"]').hide();
                       } else {
                           $('#tax6 optgroup[label="GST"]').hide();
                           $('#tax6 optgroup[label="IGST"]').show();
                       }
                   });
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    document.getElementById('rate6').value = dataRate;
                   document.getElementById('hsn6').value = dataHSN;
                    document.getElementById('desc6').value = data4
                    // document.getElementById('state').value = data5
                    // document.getElementById('cx_mail').value = data6
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst6').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst6').value = data1
                    }
                    document.getElementById('tigst6').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst6').value = data2

                }
            });

        });



        $(document).on('click', '#item7', function () {
            select = $('#item7').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);
            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                },
                success: function (response) {
                    console.log(response)
                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data5 = response.place
                    data4 = response.desc
                    data6 = response.mail
                    var customerState = data3;
                   var companyState = data5;
               
                   $(document).ready(function() {
                       if (customerState === companyState) {
                           $('#tax7 optgroup[label="GST"]').show();
                           $('#tax7 optgroup[label="IGST"]').hide();
                       } else {
                           $('#tax7 optgroup[label="GST"]').hide();
                           $('#tax7 optgroup[label="IGST"]').show();
                       }
                   });
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    document.getElementById('rate7').value = dataRate;
                   document.getElementById('hsn7').value = dataHSN;
                    document.getElementById('desc7').value = data4
                    // document.getElementById('state').value = data5
                    // document.getElementById('cx_mail').value = data6
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst7').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst7').value = data1
                    }
                    document.getElementById('tigst7').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst7').value = data2

                }
            });

        });



        $(document).on('click', '#item8', function () {
            select = $('#item8').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);
            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                },
                success: function (response) {
                    console.log(response)
                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data4 = response.desc
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    var customerState = data3;
                   var companyState = data5;
               
                   $(document).ready(function() {
                       if (customerState === companyState) {
                           $('#tax8 optgroup[label="GST"]').show();
                           $('#tax8 optgroup[label="IGST"]').hide();
                       } else {
                           $('#tax8 optgroup[label="GST"]').hide();
                           $('#tax8 optgroup[label="IGST"]').show();
                       }
                   });
                   document.getElementById('rate8').value = dataRate;
                   document.getElementById('hsn8').value = dataHSN;
                    document.getElementById('desc8').value = data4
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst8').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst8').value = data1
                    }
                    document.getElementById('tigst8').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst8').value = data2

                }
            });

        });



        $(document).on('click', '#item9', function () {
            select = $('#item9').val();
            customer = $('#customer_sel').val();
            console.log(select);
            console.log(customer);
            $.ajax({
                type: "GET",
                url: "{% url 'itemdata_challan' %}",
                data: {
                    id: select,
                    cust: customer
                },
                success: function (response) {
                    console.log(response)
                    dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                    data1 = response.gst
                    data2 = response.igst
                    data3 = response.pos
                    data4 = response.desc
                    var customerState = data3;
                   var companyState = data5;
               
                   $(document).ready(function() {
                       if (customerState === companyState) {
                           $('#tax9 optgroup[label="GST"]').show();
                           $('#tax9 optgroup[label="IGST"]').hide();
                       } else {
                           $('#tax9 optgroup[label="GST"]').hide();
                           $('#tax9 optgroup[label="IGST"]').show();
                       }
                   });
                    // place_of_supply=data3;
                    // console.log('pos:'+place_of_supply);
                    document.getElementById('rate9').value = dataRate;
                   document.getElementById('hsn9').value = dataHSN;
                    document.getElementById('desc9').value = data4
                    if (data3 == '{{ company.state }}') {
                        document.getElementById('tgst9').innerHTML = data1 + ' % GST';
                        document.getElementById('tgst9').value = data1
                    }
                    document.getElementById('tigst9').innerHTML = data2 + ' % IGST';
                    document.getElementById('tigst9').value = data2

                }
            });

        });





    });

     </script>




<script>
  var place_of_supply='';
  $(document).ready(function () {

      
      var roinc = 0
      console.log("ajax");

      $(document).on('click', '#itemm1', function () {
          select = $('#itemm1').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                  dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data5 = response.place
                  data4 = response.desc
                  data6 = response.mail
                  
                  document.getElementById('ratee1').value = dataRate;
                  document.getElementById('hsnn1').value = dataHSN;
                  document.getElementById('descc1').value = data4
                  // document.getElementById('state').value = data5
                  // document.getElementById('cx_mail').value = data6
                  console.log(data2,data1)
                 
                
                 // Assuming you have the customer state and company state values in variables
                 var customerState = data3;
                 var companyState = data5;
             
                 $(document).ready(function() {
                     if (customerState === companyState) {
                         $('#tax1 optgroup[label="GST"]').show();
                         $('#tax1 optgroup[label="IGST"]').hide();
                     } else {
                         $('#tax1 optgroup[label="GST"]').hide();
                         $('#tax1 optgroup[label="IGST"]').show();
                     }
                 });
              }
          });

      });
      $(document).on('click', '#itemm2', function () {
          select = $('#itemm2').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                  dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data5 = response.place
                  data4 = response.desc
                  data6 = response.mail

                  var customerState = data3;
                var companyState = data5;
            
                $(document).ready(function() {
                    if (customerState === companyState) {
                        $('#tax2 optgroup[label="GST"]').show();
                        $('#tax2 optgroup[label="IGST"]').hide();
                    } else {
                        $('#tax2 optgroup[label="GST"]').hide();
                        $('#tax2 optgroup[label="IGST"]').show();
                    }
                });
           
                  // place_of_supply=data3;
                  // console.log('pos:'+place_of_supply);
                  document.getElementById('ratee2').value = dataRate;
                  document.getElementById('hsnn2').value = dataHSN;
                  document.getElementById('descc2').value = data4
                  // document.getElementById('state').value = data5
                  // document.getElementById('cx_mail').value = data6
                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst2').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst2').value = data1
                  }
                  document.getElementById('tigst2').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst2').value = data2

              }
          });

      });

      $(document).on('click', '#itemm3', function () {
          select = $('#itemm3').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                  dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data5 = response.place
                  data4 = response.desc
                  data6 = response.mail
                  // place_of_supply=data3;
                  // console.log('pos:'+place_of_supply);
                  console.log(data2,data1)
                 
                
                 // Assuming you have the customer state and company state values in variables
                 var customerState = data3;
                 var companyState = data5;
             
                 $(document).ready(function() {
                     if (customerState === companyState) {
                         $('#tax3 optgroup[label="GST"]').show();
                         $('#tax3 optgroup[label="IGST"]').hide();
                     } else {
                         $('#tax3 optgroup[label="GST"]').hide();
                         $('#tax3 optgroup[label="IGST"]').show();
                     }
                 });
                 document.getElementById('ratee3').value = dataRate;
                 document.getElementById('hsnn3').value = dataHSN;
                  document.getElementById('descc3').value = data4
                  // document.getElementById('state').value = data5
                  // document.getElementById('cx_mail').value = data6
                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst3').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst3').value = data1
                  }
                  document.getElementById('tigst3').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst3').value = data2

              }
          });

      });


      $(document).on('click', '#itemm4', function () {
          select = $('#itemm4').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                  dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data5 = response.place
                  data4 = response.desc
                  data6 = response.mail
                  var customerState = data3;
                 var companyState = data5;
             
                 $(document).ready(function() {
                     if (customerState === companyState) {
                         $('#tax4 optgroup[label="GST"]').show();
                         $('#tax4 optgroup[label="IGST"]').hide();
                     } else {
                         $('#tax4 optgroup[label="GST"]').hide();
                         $('#tax4 optgroup[label="IGST"]').show();
                     }
                 });
                  // place_of_supply=data3;
                  // console.log('pos:'+place_of_supply);
                  document.getElementById('ratee4').value = dataRate;
                  document.getElementById('hsnn4').value = dataHSN;
                  document.getElementById('descc4').value = data4
                  // document.getElementById('state').value = data5
                  // document.getElementById('cx_mail').value = data6
                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst4').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst4').value = data1
                  }
                  document.getElementById('tigst4').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst4').value = data2

              }
          });

      });


      $(document).on('click', '#itemm5', function () {
          select = $('#itemm5').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                  dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data5 = response.place
                  data4 = response.desc
                  data6 = response.mail
                  var customerState = data3;
                 var companyState = data5;
             
                 $(document).ready(function() {
                     if (customerState === companyState) {
                         $('#tax5 optgroup[label="GST"]').show();
                         $('#tax5 optgroup[label="IGST"]').hide();
                     } else {
                         $('#tax5 optgroup[label="GST"]').hide();
                         $('#tax5 optgroup[label="IGST"]').show();
                     }
                 });
                  // place_of_supply=data3;
                  // console.log('pos:'+place_of_supply);
                  document.getElementById('ratee5').value = dataRate;
                  document.getElementById('hsnn5').value = dataHSN;
                  document.getElementById('descc5').value = data4
                  // document.getElementById('state').value = data5
                  // document.getElementById('cx_mail').value = data6
                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst5').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst5').value = data1
                  }
                  document.getElementById('tigst5').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst5').value = data2

              }
          });

      });


      $(document).on('click', '#itemm6', function () {
          select = $('#itemm6').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data5 = response.place
                  data4 = response.desc
                  data6 = response.mail
                  var customerState = data3;
                 var companyState = data5;
             
                 $(document).ready(function() {
                     if (customerState === companyState) {
                         $('#tax6 optgroup[label="GST"]').show();
                         $('#tax6 optgroup[label="IGST"]').hide();
                     } else {
                         $('#tax6 optgroup[label="GST"]').hide();
                         $('#tax6 optgroup[label="IGST"]').show();
                     }
                 });
                  // place_of_supply=data3;
                  // console.log('pos:'+place_of_supply);
                  document.getElementById('ratee6').value = dataRate;
                  document.getElementById('hsnn6').value = dataHSN;
                  document.getElementById('descc6').value = data4
                  // document.getElementById('state').value = data5
                  // document.getElementById('cx_mail').value = data6
                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst6').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst6').value = data1
                  }
                  document.getElementById('tigst6').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst6').value = data2

              }
          });

      });



      $(document).on('click', '#itemm7', function () {
          select = $('#itemm7').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data5 = response.place
                  data4 = response.desc
                  data6 = response.mail
                  var customerState = data3;
                 var companyState = data5;
             
                 $(document).ready(function() {
                     if (customerState === companyState) {
                         $('#tax7 optgroup[label="GST"]').show();
                         $('#tax7 optgroup[label="IGST"]').hide();
                     } else {
                         $('#tax7 optgroup[label="GST"]').hide();
                         $('#tax7 optgroup[label="IGST"]').show();
                     }
                 });
                  // place_of_supply=data3;
                  // console.log('pos:'+place_of_supply);
                  document.getElementById('ratee7').value = dataRate;
                  document.getElementById('hsnn7').value = dataHSN;
                  document.getElementById('descc7').value = data4
                  // document.getElementById('state').value = data5
                  // document.getElementById('cx_mail').value = data6
                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst7').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst7').value = data1
                  }
                  document.getElementById('tigst7').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst7').value = data2

              }
          });

      });



      $(document).on('click', '#itemm8', function () {
          select = $('#itemm8').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data4 = response.desc
                  // place_of_supply=data3;
                  // console.log('pos:'+place_of_supply);
                  var customerState = data3;
                 var companyState = data5;
             
                 $(document).ready(function() {
                     if (customerState === companyState) {
                         $('#tax8 optgroup[label="GST"]').show();
                         $('#tax8 optgroup[label="IGST"]').hide();
                     } else {
                         $('#tax8 optgroup[label="GST"]').hide();
                         $('#tax8 optgroup[label="IGST"]').show();
                     }
                 });
                 document.getElementById('ratee8').value = dataRate;
                 document.getElementById('hsnn8').value = dataHSN;
                  document.getElementById('descc8').value = data4
                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst8').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst8').value = data1
                  }
                  document.getElementById('tigst8').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst8').value = data2

              }
          });

      });



      $(document).on('click', '#itemm9', function () {
          select = $('#itemm9').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata_challan' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  dataRate = response.rate; // Fetch rate from the server response
                    dataHSN = response.hsn;
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data4 = response.desc
                  var customerState = data3;
                 var companyState = data5;
             
                 $(document).ready(function() {
                     if (customerState === companyState) {
                         $('#tax9 optgroup[label="GST"]').show();
                         $('#tax9 optgroup[label="IGST"]').hide();
                     } else {
                         $('#tax9 optgroup[label="GST"]').hide();
                         $('#tax9 optgroup[label="IGST"]').show();
                     }
                 });
                  // place_of_supply=data3;
                  // console.log('pos:'+place_of_supply);
                  document.getElementById('ratee9').value = dataRate;
                  document.getElementById('hsnn9').value = dataHSN;
                  document.getElementById('descc9').value = data4
                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst9').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst9').value = data1
                  }
                  document.getElementById('tigst9').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst9').value = data2

              }
          });

      });





  });

   </script>



<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  
      </div>
    </div>
   
  </section>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>


  $(document).on('change','#place_of_supply',function()   {
    refreshTax();
    calc();
});

function filterFunction(id){
    var options = $('#'+ $("#"+id).next().attr('id')).children();
    var search_text = $("#"+id).val().toLowerCase();
    options.each(function(){
        if($(this).text().toLowerCase().includes(search_text)){
            $(this).show()
        }else{
            $(this).hide()
        }
    })
}

function getItemDetails(inpId, value){
    var itm = value;
    var exists = false;
    var plc = $('#place_of_supply').val();
    var PLId = $('#customerPriceListId').val();
    console.log('clicked',value);

    $('#items-table-body tr').each(function () {
        var html = $(this).html();
        if (html != '') {
            var itemName = $(this).find('.item-display').val();
            console.log(itm,itemName);
            if(itemName == itm){
                exists = true;
                console.log('exists',exists);
            }
        }
    });
    console.log('status',exists);

    if(!exists){
        if(plc != ""){
            var n = inpId.slice(4);
            $.ajax({
            url: "{% url 'getInvItemDetails' %}",
            type : 'GET',
            data:{
                item : value,
                csrfmiddlewaretoken: '{{ csrf_token }}'
                },
            
            success: function(response) {
                if (response.status){
                    $('#'+inpId).val(value);
                    document.getElementById('itemId'+n).value = response.id;
                    document.getElementById('hsn'+n).value = response.hsn;
                    document.getElementById('qtyspan'+n).innerHTML = response.avl;
                    document.getElementById('avl'+n).innerHTML = response.avl;
                    document.getElementById('price'+n).value = response.sales_rate;
                    document.getElementById('priceListPrice'+n).value = response.PLPrice;
                    document.getElementById('taxGST'+n).value = response.gst;
                    document.getElementById('taxIGST'+n).value = response.igst;
                    

                    refreshTax();
                    calc();
                }
            },
            });
        }else{
            alert('Select Place of Supply.!')
        }
    }else{
        alert('Item already exists in the INVOICE, choose another or change quantity.!')
    }

}
function refreshTax(){
  var cmpState = $('#state1').val();
  var plc = $('#place_of_supply').val();
  if(cmpState == plc){
      $('.tax_ref').css('display','none');
      $('.tax_ref_gst').css('display','block');
      document.getElementById('taxamountCGST').style.display = 'flex';
      document.getElementById('taxamountSGST').style.display = 'flex';
      document.getElementById('taxamountIGST').style.display = 'none';
  }else{
      $('.tax_ref').css('display','none');
      $('.tax_ref_igst').css('display','block');
      document.getElementById('taxamountCGST').style.display = 'none';
      document.getElementById('taxamountSGST').style.display = 'none';
      document.getElementById('taxamountIGST').style.display = 'flex';
  }
}
function changeItemQty(id){
    id_val = id.slice(3)
    var qty = document.getElementById(id).value;
    var avl_val = document.getElementById(`avl${id_val}`).innerText;

    if( parseInt(qty) > parseInt(avl_val) ){
        alert("Quantity Greater than Available Quantity")
        document.getElementById(id).value = avl_val;
        calc()
    }else{
        document.getElementById(`qtyspan${id_val}`).textContent = parseInt(avl_val) - parseInt(qty);

    }
}

$(document).ready(function(){
    $('#items-table-body').on('keyup change', function () {
        refreshTax();
        calc()
    });
});

$(document).ready(function(){
    $(document).on("blur", ".disc", function(){
        if($(this).val() != ""){
        }else{
        $(this).val(0);
        calc()
        }
    }); 
});

// calculation---------------------------

function calc() {
    $('#invoiceItemsTable tbody tr').each(function () {
        var html = $(this).html();
        if (html != '') {
            var qty = $(this).find('.qty').val();
            if($('#applyPriceList').prop('checked')){
                var price = $(this).find('.priceListPrice').val();
            }else{
                var price = $(this).find('.price').val();
            }
            var dis = $(this).find('.disc').val();
            var bc = $("#place_of_supply").val();
            var compstate = $("#state1").val();

            if(bc==compstate){
                var tax = $(this).find('.tax_ref_gst').val();
            }
            else{
                var tax = $(this).find('.tax_ref_igst').val();
            }
            
            $(this).find('.total').val((parseFloat(qty) * parseFloat(price)) - parseFloat(dis));
            $(this).find('.itemTaxAmount').val(((qty * price)-dis) * (tax / 100));
            calc_total();
        }
    });
}

function calc_total() {
        
    total = 0;
    $('.total').each(function () {
        total += parseFloat($(this).val());
    });
    taxamount = 0;
    $('.itemTaxAmount').each(function () {
        taxamount += parseFloat($(this).val());
    });
    $('#sub_total').val(total.toFixed(2));
    $('#tax_amount').val(taxamount.toFixed(2));
    var ship = parseFloat($("#ship").val());
    var adj_val = parseFloat($('#adj').val())
    var gtot = taxamount + total + ship + adj_val;

    $('#grandtotal').val(gtot.toFixed(2));
    
    var adv_val = parseFloat($('#advance').val())
    var bal = gtot - adv_val
    $('#balance').val(bal.toFixed(2));
    splitTax();
}

function splitTax(){
    var bc = $("#place_of_supply").val();
    var compstate = $("#state1").val();
    
    d=0
    if (bc == compstate  ) {
        var gst = taxamount/2
        $('#cgstAmount1').val(parseFloat(gst.toFixed(2)));
        $('#sgstAmount1').val(parseFloat(gst.toFixed(2)));
        $('#igstAmount1').val(parseFloat(d.toFixed(2)));
    }else{
        $('#igstAmount1').val(taxamount.toFixed(2));
        $('#cgstAmount1').val(d.toFixed(2));
        $('#sgstAmount1').val(d.toFixed(2));
    }   
}

$(document).ready(function(){
    $(document).on('keyup',"#ship",function(){
        var subtot = $('#sub_total').val();
        var tax = $('#tax_amount').val();
        var sh = $("#ship").val();
        var adj = $("#adj").val();
        $('#grandtotal').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)).toFixed(2));
        $('#balance').val((parseFloat($("#grandtotal").val())-parseFloat($("#advance").val())).toFixed(2))
        
    });

    $(document).on("blur", "#ship", function(){
        if($(this).val() != ""){
        }else{
        $(this).val(0);
        calc_total();
        }
    }); 
});

$(document).ready(function(){
    $(document).on("keyup", "#adj", function(){
        var subtot = $('#sub_total').val();
        var tax = $('#tax_amount').val();
        var sh = $("#ship").val();
        var adj = $("#adj").val();
        $('#grandtotal').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)).toFixed(2));
        $('#balance').val((parseFloat($("#grandtotal").val())-parseFloat($("#advance").val())).toFixed(2))
    });

    $(document).on("blur", "#adj", function(){
        if($(this).val() != ""){
        }else{
        $(this).val(0);
        calc_total();
        }
    }); 
});

$(document).ready(function() {
    $("#advance").on('keyup change',function() {
        var tot_val = $('#grandtotal').val();
        var adv_val = $('#advance').val();
        if(adv_val !=""){
            if (parseFloat(tot_val) < parseFloat(adv_val)){
                $('#advance').val(parseFloat(tot_val))
                $('#balance').val(0);
                alert("Advance Greater than Total Amount")
    
            }else{
                var bal = parseFloat(tot_val) - parseFloat(adv_val)
                $('#balance').val(bal.toFixed(2));
            }
        }else{
            $('#balance').val(parseFloat(tot_val));
        }
        
    })
});

// Tabel row add, clone, remove

function refreshIndex(){
    var slNo = 1;
    var $rows = $("#items-table-body tr");

    for (var i = 0; i < $rows.length; i++) {
        $rows.eq(i).attr('id', 'tab_row'+slNo)
        $rows.eq(i).find('[id]').each(function() {
            var oldId = $(this).attr('id');
            var newId = oldId.replace(/\d+/, slNo);
            $(this).attr('id', newId );
        });

        $rows.eq(i).find('.nnum').text(slNo);
        slNo++;
    }
}

$(document).on('click','.remove_row',function(){
    var row_id = $(this).attr("id");
    $('#tab_row'+row_id+'').remove();
    refreshIndex();
    calc();
});


$(document).on('click','.clone_row',function(){
    var roinc = $("#items-table-body tr").length;
    var originalRow = $(this).closest('#items-table-body tr'); 
    var clonedRow = originalRow.clone();

    clonedRow.find('.tax_ref_gst').each(function() {
        $(this).val(originalRow.find('.tax_ref_gst').val());
    });
    clonedRow.find('.tax_ref_igst').each(function() {
        $(this).val(originalRow.find('.tax_ref_igst').val());
    });
    clonedRow.find('.item-display').val('');
    originalRow.after(clonedRow);
    refreshIndex();
    calc();
    
});



$(document).ready(function(){
$('#add').click(function(){
var roinc = $("#items-table-body tr").length;
roinc++
$('#items-table-body').append(
    `
    <tr id='tab_row${roinc}'>
        <td class="nnum" style="text-align: center;">${roinc}</td>
        <td style="width: 20%;">
            <div class="d-flex">
                <div class="w-100">
                    <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                        <input required type="text" id="item${roinc}" value="" name="item_name[]" class="dropdown-toggle form-control item-display" onkeyup="filterFunction($(this).attr('id'))"  data-toggle="dropdown" aria-expanded="false" placeholder="Items.." autocomplete="off">
                        <ul class=" w-100 items-available position-absolute" id="menu${roinc}"  style="overflow-y: auto; height: fit-content;max-height: 40vh;"> 
                            {% for i in p %}
                            <li class="dropdown-item items-options" onclick="getItemDetails($(this).parent().prev().attr('id'),$(this).html())">{{i.item_name}}</li>
                            {% endfor %}
                        </ul>
                        
                    </div>
                </div>
                <a href="#">
                    <button type="button" class="btn btn-outline-secondary ml-1" data-target="#newItem" data-toggle="modal">+</button>
                </a>
            </div>
        
        </td>
        <td>
            <input type="hidden" name="item_id[]" id="itemId${roinc}">
            <input type="text" name='hsn[]' id="hsn${roinc}" placeholder='HSN Code' class="form-control HSNCODE"  readonly />
        </td>
        <td >
            <input type="number" name='qty[]' id="qty${roinc}"  class="form-control qty mb-1" step=0 min=1  value=0 onchange="changeItemQty(this.id)" required/>
            <input type="text" id="avl${roinc}" style="display: none;">
            <div class="d-flex"><span>Available Qty :</span><span id="qtyspan${roinc}" class=''></span></div>
        </td>
        <td>
            <input type="number" name='price[]' id="price${roinc}" class="form-control price" step="0.00" min="0"  value=0 readonly />
            <input type="number" name='priceListPrice[]' id="priceListPrice${roinc}" class="form-control priceListPrice" step="0.00" min="0" style="background-color: #43596c; color: white;display: none;" value=0 readonly />
        </td>
        
        <td style="width: 13%;">
            <!-- <input type="text"  id="select_tax" placeholder="Tax Rate" class="form-control seltax d-flex"> -->
            <select name='taxGST[]' id="taxGST${roinc}" class="form-control tax_ref tax_ref_gst" style="display: block;" onchange="taxchange(this.id)">
                <option selected disabled hidden>Select GST</option>
                <option value=28 >28.0% GST</option>
                <option value=18 >18.0% GST</option>
                <option value=12 >12.0% GST</option>
                <option value=5 >05.0% GST</option>
                <option value=3 >03.0% GST</option>
                <option value=0 >0.0% GST</option>
            </select>
            <select name='taxIGST[]' id="taxIGST${roinc}" class="form-control tax_ref tax_ref_igst" style="display: none;" onchange="taxchange(this.id)">
                <option selected disabled hidden >Select IGST</option>
                <option value=28 >28.0% IGST</option>
                <option value=18 >18.0% IGST</option>
                <option value=12 >12.0% IGST</option>
                <option value=5 >05.0% IGST</option>
                <option value=3 >03.0% IGST</option>
                <option value=0 >0.0% IGST</option>
            </select>
            <div class="mt-1" style=" text-align: center;color: red;" ><span id="invalidtax${roinc}" style="display: none;"> Invalid Tax %</span> </div>    
        </td>
        <td >
            <input type="number" name='discount[]'  placeholder='Enter Discount' id="disc${roinc}" value=0 class="form-control disc" step=0 min=0   />
        </td>

        <td><input type="number" name='total[]' id="total${roinc}" class="form-control total" value=0 readonly  /></td>
        <td style="display: none;"><input type="hidden" id="taxamount${roinc}" class="form-control itemTaxAmount" /></td>
        <td>
            <button type="button" id="${roinc}" class="btn font-weight-bold clone_row fa fa-clone px-2 my-1 py-1" title="Clone Row" ></button><br>
            <button type="button" id="${roinc}" class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close" title="Remove Row"> </button>
        </td>
    </tr>
    `);
    checkPriceList();
});
});


function validateForm() {
    var cust = $('#customer').val();
    var length = $("#items-table-body tr").length;

    if(length < 1){
        alert('Add atleast 1 item..!')
        return false;
    }

    if(cust == 0){
        alert('Select customer..')
        return false;
    }
}


</script>
   
{% endblock %}